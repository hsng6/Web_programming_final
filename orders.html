<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ– - ì£¼ë¬¸ë‚´ì—­</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="ai-fit.html" class="ai-fit-link">ğŸ¤– AI í•</a>
            <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            <a href="orders.html">ì£¼ë¬¸ë‚´ì—­</a>
            <a href="support.html">ê³ ê°ì„¼í„°</a>
            <a href="wishlist.html" class="wishlist-link">â¤ï¸ ì°œ</a>
            <a href="cart.html" class="cart-link">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        </nav>
    </header>

    <main class="orders-container">
        <h2>ì£¼ë¬¸ë‚´ì—­</h2>
        
        <div class="orders-filter">
            <button class="filter-btn active" onclick="filterOrders('all')">ì „ì²´</button>
            <button class="filter-btn" onclick="filterOrders('pending')">ë°°ì†¡ì¤€ë¹„ì¤‘</button>
            <button class="filter-btn" onclick="filterOrders('shipping')">ë°°ì†¡ì¤‘</button>
            <button class="filter-btn" onclick="filterOrders('delivered')">ë°°ì†¡ì™„ë£Œ</button>
            <button class="filter-btn" onclick="filterOrders('cancelled')">ì·¨ì†Œ/í™˜ë¶ˆ</button>
        </div>

        <div id="orders-list">
            <!-- Orders will be loaded here -->
        </div>
    </main>

    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>

    <script src="main.js"></script>
    <script>
        let currentFilter = 'all';

        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const ordersList = document.getElementById('orders-list');
            
            ordersList.innerHTML = '';
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p class="empty-message">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const filteredOrders = currentFilter === 'all' 
                ? orders 
                : orders.filter(order => order.status === currentFilter);

            if (filteredOrders.length === 0) {
                ordersList.innerHTML = '<p class="empty-message">í•´ë‹¹í•˜ëŠ” ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            filteredOrders.reverse().forEach((order, index) => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-card';
                
                const statusText = {
                    'pending': 'ë°°ì†¡ì¤€ë¹„ì¤‘',
                    'shipping': 'ë°°ì†¡ì¤‘',
                    'delivered': 'ë°°ì†¡ì™„ë£Œ',
                    'cancelled': 'ì£¼ë¬¸ì·¨ì†Œ',
                    'refund_requested': 'í™˜ë¶ˆìš”ì²­',
                    'refunded': 'í™˜ë¶ˆì™„ë£Œ',
                    'exchange_requested': 'êµí™˜ìš”ì²­',
                    'exchanged': 'êµí™˜ì™„ë£Œ'
                };

                const itemsHtml = order.items.map(item => `
                    <div class="order-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="order-item-info">
                            <h4>${item.name}</h4>
                            <p>â‚©${item.price.toLocaleString()} Ã— ${item.qty}</p>
                        </div>
                    </div>
                `).join('');

                orderDiv.innerHTML = `
                    <div class="order-header">
                        <div class="order-date">${order.date}</div>
                        <div class="order-status status-${order.status}">${statusText[order.status]}</div>
                    </div>
                    <div class="order-items">
                        ${itemsHtml}
                    </div>
                    <div class="order-footer">
                        <div class="order-total">ì´ ê²°ì œê¸ˆì•¡: â‚©${order.total.toLocaleString()}</div>
                        <div class="order-actions">
                            ${getOrderActions(order, orders.length - 1 - index)}
                        </div>
                    </div>
                `;
                
                ordersList.appendChild(orderDiv);
            });
        }

        function getOrderActions(order, index) {
            const status = order.status;
            let actions = `<button class="btn-detail" onclick="viewOrderDetail(${index})">ìƒì„¸ë³´ê¸°</button>`;
            
            if (status === 'pending') {
                actions += `<button class="btn-cancel" onclick="cancelOrder(${index})">ì£¼ë¬¸ì·¨ì†Œ</button>`;
            } else if (status === 'delivered') {
                actions += `<button class="btn-exchange" onclick="requestExchange(${index})">êµí™˜ì‹ ì²­</button>`;
                actions += `<button class="btn-refund" onclick="requestRefund(${index})">í™˜ë¶ˆì‹ ì²­</button>`;
            } else if (status === 'shipping') {
                actions += `<button class="btn-info" onclick="alert('ë°°ì†¡ì¤‘ì¸ ìƒí’ˆì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë ¹ í›„ êµí™˜/í™˜ë¶ˆ ì‹ ì²­í•´ì£¼ì„¸ìš”.')">ì·¨ì†Œë¶ˆê°€</button>`;
            }
            
            return actions;
        }

        function cancelOrder(index) {
            if (!confirm('ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders[index].status = 'cancelled';
            localStorage.setItem('orders', JSON.stringify(orders));
            
            alert('ì£¼ë¬¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadOrders();
        }

        function requestExchange(index) {
            const reason = prompt('êµí™˜ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!reason) return;
            
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders[index].status = 'exchange_requested';
            orders[index].exchangeReason = reason;
            orders[index].exchangeDate = new Date().toLocaleDateString();
            localStorage.setItem('orders', JSON.stringify(orders));
            
            alert('êµí™˜ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê³ ê°ì„¼í„°ì—ì„œ í™•ì¸ í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.');
            loadOrders();
        }

        function requestRefund(index) {
            const reason = prompt('í™˜ë¶ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!reason) return;
            
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders[index].status = 'refund_requested';
            orders[index].refundReason = reason;
            orders[index].refundDate = new Date().toLocaleDateString();
            localStorage.setItem('orders', JSON.stringify(orders));
            
            alert('í™˜ë¶ˆ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê³ ê°ì„¼í„°ì—ì„œ í™•ì¸ í›„ í™˜ë¶ˆ ì²˜ë¦¬ë©ë‹ˆë‹¤.');
            loadOrders();
        }

        function filterOrders(status) {
            currentFilter = status;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // cancelled í•„í„°ëŠ” ëª¨ë“  ì·¨ì†Œ/í™˜ë¶ˆ/êµí™˜ ìƒíƒœ í¬í•¨
            if (status === 'cancelled') {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const ordersList = document.getElementById('orders-list');
                ordersList.innerHTML = '';
                
                const cancelledOrders = orders.filter(order => 
                    ['cancelled', 'refund_requested', 'refunded', 'exchange_requested', 'exchanged'].includes(order.status)
                );
                
                if (cancelledOrders.length === 0) {
                    ordersList.innerHTML = '<p class="empty-message">ì·¨ì†Œ/í™˜ë¶ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                const statusText = {
                    'pending': 'ë°°ì†¡ì¤€ë¹„ì¤‘',
                    'shipping': 'ë°°ì†¡ì¤‘',
                    'delivered': 'ë°°ì†¡ì™„ë£Œ',
                    'cancelled': 'ì£¼ë¬¸ì·¨ì†Œ',
                    'refund_requested': 'í™˜ë¶ˆìš”ì²­',
                    'refunded': 'í™˜ë¶ˆì™„ë£Œ',
                    'exchange_requested': 'êµí™˜ìš”ì²­',
                    'exchanged': 'êµí™˜ì™„ë£Œ'
                };
                
                cancelledOrders.reverse().forEach((order, idx) => {
                    const orderDiv = document.createElement('div');
                    orderDiv.className = 'order-card';
                    
                    const itemsHtml = order.items.map(item => `
                        <div class="order-item">
                            <img src="${item.image}" alt="${item.name}">
                            <div class="order-item-info">
                                <h4>${item.name}</h4>
                                <p>â‚©${item.price.toLocaleString()} Ã— ${item.qty}</p>
                            </div>
                        </div>
                    `).join('');
                    
                    const originalIndex = orders.indexOf(order);
                    
                    orderDiv.innerHTML = `
                        <div class="order-header">
                            <div class="order-date">${order.date}</div>
                            <div class="order-status status-${order.status}">${statusText[order.status]}</div>
                        </div>
                        <div class="order-items">
                            ${itemsHtml}
                        </div>
                        <div class="order-footer">
                            <div class="order-total">ì´ ê²°ì œê¸ˆì•¡: â‚©${order.total.toLocaleString()}</div>
                            <div class="order-actions">
                                <button class="btn-detail" onclick="viewOrderDetail(${originalIndex})">ìƒì„¸ë³´ê¸°</button>
                            </div>
                        </div>
                    `;
                    
                    ordersList.appendChild(orderDiv);
                });
                return;
            }
            
            loadOrders();
        }

        function viewOrderDetail(index) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders[index];
            
            alert(`ì£¼ë¬¸ë²ˆí˜¸: ${index + 1}\nì£¼ë¬¸ì¼: ${order.date}\nìƒíƒœ: ${order.status}\nì´ì•¡: â‚©${order.total.toLocaleString()}`);
        }

        // Load theme on page load
        function loadTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadOrders();
        });
    </script>
</body>
</html>

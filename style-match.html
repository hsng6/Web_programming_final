<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ– - ìŠ¤íƒ€ì¼ ë§¤ì¹­</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="ai-fit.html">ğŸ¤– AI í•</a>
            <a href="virtual-fitting.html">ğŸ‘— ê°€ìƒ í”¼íŒ…ë£¸</a>
            <a href="style-match.html" class="highlight-link">âœ¨ ìŠ¤íƒ€ì¼ ë§¤ì¹­</a>
            <a href="recommendations.html">âœ¨ ì¶”ì²œ</a>
            <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            <a href="cart.html">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        </nav>
    </header>

    <main class="style-match-container">
        <h2>ğŸ¨ AI ìŠ¤íƒ€ì¼ ë§¤ì¹­</h2>
        <p class="subtitle">ìƒí’ˆì„ ì„ íƒí•˜ë©´ AIê°€ ì–´ìš¸ë¦¬ëŠ” ì½”ë””ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤!</p>

        <div class="match-workspace">
            <!-- ê¸°ë³¸ ì•„ì´í…œ ì„ íƒ -->
            <section class="base-item-section">
                <h3>1ï¸âƒ£ ê¸°ë³¸ ì•„ì´í…œ ì„ íƒ</h3>
                <div class="category-tabs">
                    <button class="tab-btn active" onclick="loadBaseItems('TOPS')">ìƒì˜</button>
                    <button class="tab-btn" onclick="loadBaseItems('PANTS')">í•˜ì˜</button>
                    <button class="tab-btn" onclick="loadBaseItems('OUTER')">ì•„ìš°í„°</button>
                    <button class="tab-btn" onclick="loadBaseItems('SHOES')">ì‹ ë°œ</button>
                </div>
                <div id="base-items-grid" class="items-grid">
                    <!-- ì•„ì´í…œë“¤ì´ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- AI ì½”ë”” ì¶”ì²œ ê²°ê³¼ -->
            <section class="matching-result">
                <h3>2ï¸âƒ£ AI ì¶”ì²œ ì½”ë””</h3>
                <div id="matching-display" class="matching-display">
                    <div class="placeholder-message">
                        <p>ğŸ‘”</p>
                        <p>ì•„ì´í…œì„ ì„ íƒí•˜ë©´</p>
                        <p>AIê°€ ì–´ìš¸ë¦¬ëŠ” ì½”ë””ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤!</p>
                    </div>
                    <div id="matched-outfit" class="matched-outfit" style="display: none;">
                        <div class="outfit-preview">
                            <div class="outfit-item base-item">
                                <img id="base-item-img" src="" alt="Base Item">
                                <div class="item-label">ì„ íƒí•œ ì•„ì´í…œ</div>
                            </div>
                            <div class="plus-icon">+</div>
                            <div class="outfit-item matched-item">
                                <img id="matched-item-img" src="" alt="Matched Item">
                                <div class="item-label">ì¶”ì²œ ì•„ì´í…œ</div>
                            </div>
                        </div>
                        <div class="outfit-details">
                            <h4>ğŸ’¡ ì½”ë”” ì„¤ëª…</h4>
                            <p id="outfit-explanation"></p>
                            <div class="outfit-tags" id="outfit-tags"></div>
                        </div>
                        <div class="outfit-actions">
                            <button class="btn-primary" onclick="addOutfitToCart()">ì „ì²´ ë‹´ê¸°</button>
                            <button class="btn-secondary" onclick="refreshMatch()">ë‹¤ë¥¸ ì½”ë”” ë³´ê¸°</button>
                            <button class="btn-secondary" onclick="saveOutfit()">ì €ì¥í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì™„ì„±ëœ ì½”ë”” ëª©ë¡ -->
            <section class="complete-outfits">
                <h3>3ï¸âƒ£ ì¶”ê°€ ì½”ë”” ì œì•ˆ</h3>
                <div id="more-outfits" class="more-outfits-grid">
                    <!-- ì¶”ê°€ ì½”ë””ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </section>
        </div>

        <!-- ì €ì¥ëœ ì½”ë””ë¶ -->
        <section class="saved-outfits">
            <h3>ğŸ“š ë‚˜ì˜ ì½”ë””ë¶</h3>
            <div id="outfit-book" class="outfit-book-grid">
                <!-- ì €ì¥ëœ ì½”ë””ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>

    <script src="main.js"></script>
    <script>
        let selectedBaseItem = null;
        let currentCategory = 'TOPS';

        // ê¸°ë³¸ ì•„ì´í…œ ë¡œë“œ
        function loadBaseItems(category) {
            currentCategory = category;
            const grid = document.getElementById('base-items-grid');
            const items = PRODUCTS.filter(p => p.category === category);

            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            grid.innerHTML = items.map(item => `
                <div class="style-item-card" onclick="selectBaseItem(${item.id})">
                    <img src="${item.image}" alt="${item.name}">
                    <h4>${item.name}</h4>
                    <p class="brand">${item.brand || ''}</p>
                    <p class="price">â‚©${item.price.toLocaleString()}</p>
                </div>
            `).join('');
        }

        // ê¸°ë³¸ ì•„ì´í…œ ì„ íƒ
        function selectBaseItem(itemId) {
            selectedBaseItem = PRODUCTS.find(p => p.id === itemId);

            // ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.style-item-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.style-item-card').classList.add('selected');

            generateMatching();
        }

        // AI ë§¤ì¹­ ìƒì„±
        function generateMatching() {
            if (!selectedBaseItem) return;

            const placeholder = document.querySelector('.placeholder-message');
            const matched = document.getElementById('matched-outfit');

            // ë¡œë”© í‘œì‹œ
            placeholder.innerHTML = `
                <div class="loader-spinner"></div>
                <p>AIê°€ ìµœì ì˜ ì½”ë””ë¥¼ ì°¾ëŠ” ì¤‘...</p>
            `;

            setTimeout(() => {
                // ë§¤ì¹­ ì•„ì´í…œ ì°¾ê¸°
                const matchedItem = findMatchingItem(selectedBaseItem);

                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('base-item-img').src = selectedBaseItem.image;
                document.getElementById('matched-item-img').src = matchedItem.image;

                // ì½”ë”” ì„¤ëª… ìƒì„±
                const explanation = generateOutfitExplanation(selectedBaseItem, matchedItem);
                document.getElementById('outfit-explanation').textContent = explanation;

                // ìŠ¤íƒ€ì¼ íƒœê·¸
                const tags = getStyleTags(selectedBaseItem, matchedItem);
                document.getElementById('outfit-tags').innerHTML = tags.map(tag =>
                    `<span class="style-tag">#${tag}</span>`
                ).join('');

                placeholder.style.display = 'none';
                matched.style.display = 'block';

                // ì¶”ê°€ ì½”ë”” ì œì•ˆ
                loadMoreOutfits();
            }, 1500);
        }

        // ë§¤ì¹­ ì•„ì´í…œ ì°¾ê¸° (AI ì‹œë®¬ë ˆì´ì…˜)
        function findMatchingItem(baseItem) {
            let matchCategory;

            // ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¹­ ë¡œì§
            if (baseItem.category === 'TOPS') {
                matchCategory = Math.random() > 0.5 ? 'PANTS' : 'OUTER';
            } else if (baseItem.category === 'PANTS') {
                matchCategory = Math.random() > 0.5 ? 'TOPS' : 'SHOES';
            } else if (baseItem.category === 'OUTER') {
                matchCategory = 'PANTS';
            } else {
                matchCategory = 'TOPS';
            }

            // ìƒ‰ìƒ ë§¤ì¹­ ê³ ë ¤
            const candidates = PRODUCTS.filter(p => p.category === matchCategory);

            // ìƒ‰ìƒ ì¡°í™” ì ìˆ˜ ê³„ì‚°
            const scored = candidates.map(item => ({
                item,
                score: calculateColorHarmony(baseItem.colors, item.colors)
            }));

            scored.sort((a, b) => b.score - a.score);
            return scored[0].item;
        }

        // ìƒ‰ìƒ ì¡°í™” ì ìˆ˜ ê³„ì‚°
        function calculateColorHarmony(colors1, colors2) {
            if (!colors1 || !colors2) return Math.random();

            const complementary = {
                'ë¸”ë™': ['í™”ì´íŠ¸', 'ê·¸ë ˆì´', 'ë² ì´ì§€'],
                'í™”ì´íŠ¸': ['ë¸”ë™', 'ë„¤ì´ë¹„', 'ê·¸ë ˆì´'],
                'ë„¤ì´ë¹„': ['í™”ì´íŠ¸', 'ë² ì´ì§€', 'ì¹´í‚¤'],
                'ê·¸ë ˆì´': ['í™”ì´íŠ¸', 'ë¸”ë™', 'ë„¤ì´ë¹„'],
                'ë² ì´ì§€': ['ë¸Œë¼ìš´', 'ì¹´í‚¤', 'í™”ì´íŠ¸']
            };

            let score = 0;
            colors1.forEach(c1 => {
                colors2.forEach(c2 => {
                    if (complementary[c1]?.includes(c2)) score += 10;
                    if (c1 === c2) score += 3; // ê°™ì€ ìƒ‰ìƒë„ ì•½ê°„ì˜ ì ìˆ˜
                });
            });

            return score + Math.random() * 5;
        }

        // ì½”ë”” ì„¤ëª… ìƒì„±
        function generateOutfitExplanation(item1, item2) {
            const explanations = [
                `${item1.brand}ì˜ ${item1.name}ì™€ ${item2.brand}ì˜ ${item2.name}ì˜ ì¡°í•©ì€ íŠ¸ë Œë””í•˜ë©´ì„œë„ í¸ì•ˆí•œ ìŠ¤íƒ€ì¼ì„ ì—°ì¶œí•©ë‹ˆë‹¤.`,
                `í´ë˜ì‹í•œ ${item1.name}ì— ${item2.name}ë¥¼ ë§¤ì¹˜í•˜ë©´ ì„¸ë ¨ëœ ë„ì‹œì  ê°ì„±ì„ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                `${item1.name}ì˜ ì‹¬í”Œí•¨ì„ ${item2.name}ë¡œ ì™„ì„±í•˜ëŠ” ë¯¸ë‹ˆë©€ ì½”ë””ì…ë‹ˆë‹¤.`,
                `ìºì£¼ì–¼í•œ ${item1.name}ì™€ ${item2.name}ì˜ ë§Œë‚¨ìœ¼ë¡œ ë°ì¼ë¦¬ë£© ì™„ì„±!`,
                `${item1.name}ì˜ í¸ì•ˆí•¨ê³¼ ${item2.name}ì˜ ìŠ¤íƒ€ì¼ë¦¬ì‹œí•¨ì´ ì¡°í™”ë¥¼ ì´ë£¹ë‹ˆë‹¤.`
            ];

            return explanations[Math.floor(Math.random() * explanations.length)];
        }

        // ìŠ¤íƒ€ì¼ íƒœê·¸ ìƒì„±
        function getStyleTags(item1, item2) {
            const allTags = ['ìºì£¼ì–¼', 'ë¯¸ë‹ˆë©€', 'ëª¨ë˜', 'í´ë˜ì‹', 'íŠ¸ë Œë””', 'ì‹¬í”Œ', 'í¸ì•ˆí•¨', 'ì„¸ë ¨ë¨', 'ë„ì‹œì ', 'ë°ì¼ë¦¬'];
            const shuffled = allTags.sort(() => Math.random() - 0.5);
            return shuffled.slice(0, 3);
        }

        // ì¶”ê°€ ì½”ë”” ë¡œë“œ
        function loadMoreOutfits() {
            const moreOutfits = document.getElementById('more-outfits');
            const alternatives = PRODUCTS
                .filter(p => p.id !== selectedBaseItem.id && p.category !== selectedBaseItem.category)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3);

            moreOutfits.innerHTML = alternatives.map(item => `
                <div class="mini-outfit-card" onclick="showAlternativeOutfit(${item.id})">
                    <div class="mini-outfit-images">
                        <img src="${selectedBaseItem.image}" alt="${selectedBaseItem.name}">
                        <span class="mini-plus">+</span>
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <p>${selectedBaseItem.name} + ${item.name}</p>
                    <p class="total-price">â‚©${(selectedBaseItem.price + item.price).toLocaleString()}</p>
                </div>
            `).join('');
        }

        // ëŒ€ì•ˆ ì½”ë”” í‘œì‹œ
        function showAlternativeOutfit(itemId) {
            const newMatch = PRODUCTS.find(p => p.id === itemId);

            document.getElementById('matched-item-img').src = newMatch.image;

            const explanation = generateOutfitExplanation(selectedBaseItem, newMatch);
            document.getElementById('outfit-explanation').textContent = explanation;

            const tags = getStyleTags(selectedBaseItem, newMatch);
            document.getElementById('outfit-tags').innerHTML = tags.map(tag =>
                `<span class="style-tag">#${tag}</span>`
            ).join('');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ë‹¤ë¥¸ ì½”ë”” ë³´ê¸°
        function refreshMatch() {
            generateMatching();
        }

        // ì „ì²´ ë‹´ê¸°
        function addOutfitToCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const matchedItemSrc = document.getElementById('matched-item-img').src;
            const matchedItem = PRODUCTS.find(p => p.image === matchedItemSrc);

            [selectedBaseItem, matchedItem].forEach(item => {
                const existing = cart.find(c => c.id === item.id);
                if (existing) {
                    existing.qty += 1;
                } else {
                    cart.push({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        image: item.image,
                        qty: 1,
                        size: 'M'
                    });
                }
            });

            localStorage.setItem('cart', JSON.stringify(cart));
            alert('ì½”ë”” ì „ì²´ê°€ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ›’');
        }

        // ì½”ë”” ì €ì¥
        function saveOutfit() {
            const outfits = JSON.parse(localStorage.getItem('savedOutfits')) || [];
            const matchedItemSrc = document.getElementById('matched-item-img').src;
            const matchedItem = PRODUCTS.find(p => p.image === matchedItemSrc);

            const outfit = {
                id: Date.now(),
                baseItem: selectedBaseItem,
                matchedItem: matchedItem,
                explanation: document.getElementById('outfit-explanation').textContent,
                tags: Array.from(document.querySelectorAll('.style-tag')).map(tag => tag.textContent),
                date: new Date().toLocaleDateString('ko-KR')
            };

            outfits.unshift(outfit);
            localStorage.setItem('savedOutfits', JSON.stringify(outfits));

            alert('ì½”ë””ë¶ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“š');
            loadOutfitBook();
        }

        // ì½”ë””ë¶ ë¡œë“œ
        function loadOutfitBook() {
            const outfits = JSON.parse(localStorage.getItem('savedOutfits')) || [];
            const book = document.getElementById('outfit-book');

            if (outfits.length === 0) {
                book.innerHTML = '<p class="empty-message">ì €ì¥ëœ ì½”ë””ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            book.innerHTML = outfits.map(outfit => `
                <div class="saved-outfit-card">
                    <div class="saved-outfit-images">
                        <img src="${outfit.baseItem.image}" alt="${outfit.baseItem.name}">
                        <span class="saved-plus">+</span>
                        <img src="${outfit.matchedItem.image}" alt="${outfit.matchedItem.name}">
                    </div>
                    <p class="saved-date">${outfit.date}</p>
                    <div class="saved-tags">${outfit.tags.join(' ')}</div>
                    <button class="btn-reuse" onclick="reuseOutfit(${outfit.id})">ë‹¤ì‹œ ë³´ê¸°</button>
                </div>
            `).join('');
        }

        // ì €ì¥ëœ ì½”ë”” ì¬ì‚¬ìš©
        function reuseOutfit(id) {
            const outfits = JSON.parse(localStorage.getItem('savedOutfits')) || [];
            const outfit = outfits.find(o => o.id === id);
            if (!outfit) return;

            selectedBaseItem = outfit.baseItem;

            document.getElementById('base-item-img').src = outfit.baseItem.image;
            document.getElementById('matched-item-img').src = outfit.matchedItem.image;
            document.getElementById('outfit-explanation').textContent = outfit.explanation;
            document.getElementById('outfit-tags').innerHTML = outfit.tags.map(tag =>
                `<span class="style-tag">${tag}</span>`
            ).join('');

            document.querySelector('.placeholder-message').style.display = 'none';
            document.getElementById('matched-outfit').style.display = 'block';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // í…Œë§ˆ
        function loadTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadBaseItems('TOPS');
            loadOutfitBook();
        });
    </script>
</body>

</html>
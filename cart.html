<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ– - ì¥ë°”êµ¬ë‹ˆ</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="ai-fit.html" class="ai-fit-link">ğŸ¤– AI í•</a>
            <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            <a href="orders.html">ì£¼ë¬¸ë‚´ì—­</a>
            <a href="support.html">ê³ ê°ì„¼í„°</a>
            <a href="wishlist.html" class="wishlist-link">â¤ï¸ ì°œ</a>
            <a href="cart.html" class="cart-link">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        </nav>
    </header>
    <main>
        <div id="cart-items">
            <!-- JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œì„ ì¶”ê°€í•©ë‹ˆë‹¤ -->
        </div>
        <div id="cart-total">
            <h2>ì´ ê¸ˆì•¡: <span id="total-price">â‚©0</span></h2>
            <button id="checkout">ê²°ì œí•˜ê¸°</button>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast"></div>

    <script src="main.js"></script>
    <script>
        // Load and display cart items
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const cartItemsDiv = document.getElementById("cart-items");
            const totalPriceSpan = document.getElementById("total-price");

            cartItemsDiv.innerHTML = "";

            if (cart.length === 0) {
                cartItemsDiv.innerHTML = "<p>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>";
                totalPriceSpan.textContent = "â‚©0";
                return;
            }

            let total = 0;

            cart.forEach((item, index) => {
                // quantity ì²˜ë¦¬ (ê¸°ì¡´ qtyì™€ ìƒˆë¡œìš´ quantity ëª¨ë‘ ì§€ì›)
                const quantity = item.quantity || item.qty || 1;
                const itemTotal = (item.price || 0) * quantity;
                total += itemTotal;

                // ì´ë¯¸ì§€ URL í™•ì¸
                const imageUrl = item.image || 'https://via.placeholder.com/150';

                const cartItem = document.createElement("div");
                cartItem.className = "cart-item";
                cartItem.innerHTML = `
                    <img src="${imageUrl}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/150'">
                    <div class="item-details">
                        <h3>${item.name}</h3>
                        ${item.color ? `<p class="item-color">ìƒ‰ìƒ: <strong>${item.color}</strong></p>` : ''}
                        ${item.size ? `<p class="item-size">ì‚¬ì´ì¦ˆ: <strong>${item.size}</strong></p>` : ''}
                        <p class="item-price">ë‹¨ê°€: â‚©${(item.price || 0).toLocaleString()}</p>
                        <div class="quantity-control">
                            <label for="quantity-${index}">ìˆ˜ëŸ‰:</label>
                            <div class="quantity-buttons">
                                <button class="qty-decrease" data-index="${index}">-</button>
                                <input type="number" id="quantity-${index}" class="quantity-input" value="${quantity}" min="1" readonly data-index="${index}">
                                <button class="qty-increase" data-index="${index}">+</button>
                            </div>
                        </div>
                        <p class="item-total">ì†Œê³„: â‚©${itemTotal.toLocaleString()}</p>
                        <button class="remove-item" data-index="${index}">ì‚­ì œ</button>
                    </div>
                `;
                cartItemsDiv.appendChild(cartItem);
            });

            totalPriceSpan.textContent = `â‚©${total.toLocaleString()}`;

            // Add event listeners for quantity increase
            document.querySelectorAll('.qty-increase').forEach(button => {
                button.addEventListener('click', function () {
                    const index = parseInt(this.getAttribute('data-index'));
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                    const currentQty = cart[index].quantity || cart[index].qty || 1;
                    updateQuantity(index, currentQty + 1);
                });
            });

            // Add event listeners for quantity decrease
            document.querySelectorAll('.qty-decrease').forEach(button => {
                button.addEventListener('click', function () {
                    const index = parseInt(this.getAttribute('data-index'));
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                    const currentQty = cart[index].quantity || cart[index].qty || 1;
                    if (currentQty > 1) {
                        updateQuantity(index, currentQty - 1);
                    }
                });
            });

            // Add event listeners for remove buttons
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function () {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeItem(index);
                });
            });
        }

        function updateQuantity(index, newQty) {
            if (newQty < 1) return;

            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart[index]) {
                // quantityì™€ qty ëª¨ë‘ ì—…ë°ì´íŠ¸
                cart[index].quantity = newQty;
                cart[index].qty = newQty;
                localStorage.setItem("cart", JSON.stringify(cart));
                loadCart();
            }
        }

        function removeItem(index) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            loadCart();
        }

        // Load theme on page load
        function loadTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // Load cart on page load
        document.addEventListener('DOMContentLoaded', function () {
            // ë¡œê·¸ì¸ ì²´í¬
            if (!requireLogin('ì¥ë°”êµ¬ë‹ˆëŠ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.')) {
                return;
            }

            loadTheme();
            loadCart();
        });

        // Checkout button
        document.getElementById('checkout').addEventListener('click', function () {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0) {
                alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤!");
                return;
            }
            window.location.href = "payment.html";
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ–</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://via.placeholder.com">
    <link rel="dns-prefetch" href="https://via.placeholder.com">
</head>

<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <div class="search-container">
            <input type="text" id="search-input" placeholder="ìƒí’ˆ ê²€ìƒ‰...">
            <button id="search-btn">ê²€ìƒ‰</button>
        </div>
        <nav>
            <a href="wishlist.html" class="wishlist-link">â¤ï¸</a>
            <a href="cart.html" class="cart-link">&#128722;</a>
            <span id="user-info" style="color: #667eea; font-weight: bold;"></span>
            <a href="login.html" id="login-btn"
                style="background: #667eea; color: white; padding: 0.5rem 1rem; border-radius: 5px; text-decoration: none;">ë¡œê·¸ì¸</a>
            <button id="logout-btn" onclick="logout()"
                style="display: none; background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">ë¡œê·¸ì•„ì›ƒ</button>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
            <button class="hamburger-menu" onclick="toggleMenu()">â˜°</button>
        </nav>
    </header>

    <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
    <div id="side-menu" class="side-menu">
        <div class="side-menu-header">
            <h2>ë©”ë‰´</h2>
            <button class="close-menu" onclick="toggleMenu()">âœ•</button>
        </div>
        <div class="side-menu-content">
            <a href="index.html">ğŸ  í™ˆ</a>
            <a href="ai-fit.html">ğŸ¤– AI í•</a>
            <a href="virtual-fitting.html">ğŸ‘— ê°€ìƒ í”¼íŒ…</a>
            <a href="style-match.html">âœ¨ ìŠ¤íƒ€ì¼ ë§¤ì¹­</a>
            <a href="recommendations.html">âœ¨ ì¶”ì²œ</a>
            <a href="coupons.html">ğŸŸï¸ ì¿ í°</a>
            <a href="mypage.html">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</a>
            <a href="orders.html">ğŸ“¦ ì£¼ë¬¸ë‚´ì—­</a>
            <a href="support.html">ğŸ’¬ ê³ ê°ì„¼í„°</a>
            <a href="wishlist.html">â¤ï¸ ì°œ</a>
            <a href="cart.html">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a>
        </div>
    </div>
    <div id="menu-overlay" class="menu-overlay" onclick="toggleMenu()"></div>

    <main>
        <!-- Category Navigation -->
        <nav id="category-nav">
            <button class="category-btn active" data-category="ALL">ì „ì²´</button>
            <button class="category-btn" data-category="TOPS">TOPS</button>
            <button class="category-btn" data-category="PANTS">PANTS</button>
            <button class="category-btn" data-category="OUTER">OUTER</button>
            <button class="category-btn" data-category="SHOES">SHOES</button>
        </nav>

        <!-- Sort and Filter Bar -->
        <div class="sort-filter-bar">
            <div class="sort-options">
                <label>ì •ë ¬:</label>
                <select id="sort-select" onchange="sortProducts(this.value)">
                    <option value="default">ê¸°ë³¸ìˆœ</option>
                    <option value="price-low">ë‚®ì€ ê°€ê²©ìˆœ</option>
                    <option value="price-high">ë†’ì€ ê°€ê²©ìˆœ</option>
                    <option value="popular">ì¸ê¸°ìˆœ (ë¦¬ë·°ë§ì€ìˆœ)</option>
                    <option value="rating">í‰ì ìˆœ</option>
                </select>
            </div>
            <div class="filter-section">
                <button id="filter-toggle-btn" onclick="toggleFilters()">ğŸ” í•„í„°</button>
            </div>
            <div class="view-options">
                <button onclick="window.location.href='wishlist.html'" class="wishlist-link">â¤ï¸ ì°œí•œìƒí’ˆ <span
                        id="wishlist-count">0</span></button>
            </div>
        </div>

        <!-- Advanced Filters (collapsible) -->
        <div id="advanced-filters" class="advanced-filters" style="display: none;">
            <div class="filter-group">
                <label>ê°€ê²©ëŒ€:</label>
                <div class="price-range">
                    <input type="number" id="price-min" placeholder="ìµœì†Œ" min="0" step="1000">
                    <span>~</span>
                    <input type="number" id="price-max" placeholder="ìµœëŒ€" min="0" step="1000">
                </div>
            </div>
            <div class="filter-group">
                <label>ë¸Œëœë“œ:</label>
                <div class="filter-checkboxes" id="brand-filters">
                    <!-- Dynamically populated -->
                </div>
            </div>
            <div class="filter-group">
                <label>ìƒ‰ìƒ:</label>
                <div class="filter-checkboxes color-filters" id="color-filters">
                    <!-- Dynamically populated -->
                </div>
            </div>
            <div class="filter-actions">
                <button onclick="applyFilters()" class="btn-apply">í•„í„° ì ìš©</button>
                <button onclick="resetFilters()" class="btn-reset">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- Products Section -->
        <section id="products-section">
            <h2 id="category-title">ì „ì²´ ìƒí’ˆ</h2>
            <div id="product-list" class="product-grid">
                <!-- JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ìƒí’ˆì„ ì¶”ê°€í•©ë‹ˆë‹¤ -->
            </div>
        </section>

        <!-- Recently Viewed Products -->
        <section id="recent-products-section" style="display: none;">
            <h2>ìµœê·¼ ë³¸ ìƒí’ˆ</h2>
            <div id="recent-products-list" class="product-grid-horizontal">
                <!-- Recently viewed products will be loaded here -->
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="main.js"></script>
    <script>
        // í–„ë²„ê±° ë©”ë‰´ í† ê¸€
        function toggleMenu() {
            const sideMenu = document.getElementById('side-menu');
            const overlay = document.getElementById('menu-overlay');

            if (sideMenu.classList.contains('active')) {
                sideMenu.classList.remove('active');
                overlay.classList.remove('active');
            } else {
                sideMenu.classList.add('active');
                overlay.classList.add('active');
            }
        }

        // Update cart count on page load
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const totalItems = cart.reduce((sum, item) => sum + (parseInt(item.qty) || 0), 0);
            const countElement = document.getElementById('cart-count');
            if (countElement) {
                if (totalItems > 0) {
                    countElement.classList.add('has-items');
                } else {
                    countElement.classList.remove('has-items');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            updateCartCount();
            updateWishlistCount();
            loadRecentProducts();
            loadTheme();
            populateFilterOptions();
        });

        // í•„í„° ì˜µì…˜ ë™ì  ìƒì„±
        function populateFilterOptions() {
            const brands = [...new Set(PRODUCTS.map(p => p.brand))].sort();
            const colors = [...new Set(PRODUCTS.flatMap(p => p.colors || []))].sort();

            const brandFilters = document.getElementById('brand-filters');
            const colorFilters = document.getElementById('color-filters');

            brandFilters.innerHTML = brands.map(brand => `
                <label class="filter-checkbox">
                    <input type="checkbox" name="brand" value="${brand}">
                    <span>${brand}</span>
                </label>
            `).join('');

            colorFilters.innerHTML = colors.map(color => `
                <label class="filter-checkbox color-option">
                    <input type="checkbox" name="color" value="${color}">
                    <span class="color-circle" style="background-color: ${getColorCode(color)};" title="${color}"></span>
                    <span>${color}</span>
                </label>
            `).join('');
        }

        function getColorCode(colorName) {
            const colorMap = {
                'í™”ì´íŠ¸': '#ffffff',
                'ë¸”ë™': '#000000',
                'ê·¸ë ˆì´': '#808080',
                'ë„¤ì´ë¹„': '#000080',
                'ë¸”ë£¨': '#0066cc',
                'ë¼ì´íŠ¸ë¸”ë£¨': '#87ceeb',
                'ë² ì´ì§€': '#f5f5dc',
                'ë¸Œë¼ìš´': '#8b4513',
                'ì¹´í‚¤': '#c3b091',
                'ì¹´ë©œ': '#c19a6b',
                'í•‘í¬': '#ffb6c1',
                'ì•„ì´ë³´ë¦¬': '#fffff0'
            };
            return colorMap[colorName] || '#ddd';
        }

        // í•„í„° í† ê¸€
        function toggleFilters() {
            const filters = document.getElementById('advanced-filters');
            filters.style.display = filters.style.display === 'none' ? 'block' : 'none';
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const priceMin = parseInt(document.getElementById('price-min').value) || 0;
            const priceMax = parseInt(document.getElementById('price-max').value) || Infinity;

            const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked'))
                .map(cb => cb.value);
            const selectedColors = Array.from(document.querySelectorAll('input[name="color"]:checked'))
                .map(cb => cb.value);

            let filtered = PRODUCTS.filter(product => {
                // ê°€ê²© í•„í„°
                if (product.price < priceMin || product.price > priceMax) return false;

                // ë¸Œëœë“œ í•„í„°
                if (selectedBrands.length > 0 && !selectedBrands.includes(product.brand)) return false;

                // ìƒ‰ìƒ í•„í„°
                if (selectedColors.length > 0) {
                    const hasColor = product.colors?.some(c => selectedColors.includes(c));
                    if (!hasColor) return false;
                }

                return true;
            });

            renderFilteredProducts(filtered);
            showToast(`${filtered.length}ê°œì˜ ìƒí’ˆì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function renderFilteredProducts(products) {
            const productList = document.getElementById("product-list");
            const categoryTitle = document.getElementById("category-title");

            productList.innerHTML = "";
            categoryTitle.textContent = `í•„í„° ê²°ê³¼ (${products.length}ê°œ)`;

            if (products.length === 0) {
                productList.innerHTML = '<p style="text-align: center; padding: 50px; color: #999;">ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const reviewsCache = {};
            products.forEach(product => {
                const reviews = JSON.parse(localStorage.getItem(`reviews_${product.id}`)) || [];
                reviewsCache[product.id] = {
                    count: reviews.length,
                    average: reviews.length > 0
                        ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1)
                        : 0
                };
            });

            const fragment = document.createDocumentFragment();

            products.forEach(product => {
                const reviewData = reviewsCache[product.id];
                const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
                const isWished = wishlist.includes(product.id);
                const totalStock = window.getTotalStock ? window.getTotalStock(product.id) : 999;
                const isSoldOut = totalStock === 0;

                const productCard = document.createElement("div");
                productCard.className = "product-card";
                if (isSoldOut) productCard.classList.add('sold-out');
                productCard.onclick = function () { viewProduct(product.id); };
                productCard.innerHTML = `
                    ${isSoldOut ? '<div class="sold-out-badge">í’ˆì ˆ</div>' : ''}
                    <button class="wishlist-btn ${isWished ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist(${product.id});" title="ì°œí•˜ê¸°">â¤ï¸</button>
                    <img src="${product.image}" alt="${product.name}" loading="lazy" ${isSoldOut ? 'style="opacity: 0.5;"' : ''}>
                    <h3>${product.name}</h3>
                    <p class="product-brand">${product.brand}</p>
                    <p class="product-price">â‚©${product.price.toLocaleString()}</p>
                    <div class="product-colors">${(product.colors || []).map(c =>
                    `<span class="color-dot" style="background-color: ${getColorCode(c)};" title="${c}"></span>`
                ).join('')}</div>
                    <div class="product-review-info">
                        <span class="rating-stars">${'â­'.repeat(Math.round(reviewData.average))}</span>
                        <span class="rating-text">${reviewData.average} (${reviewData.count})</span>
                    </div>
                `;
                fragment.appendChild(productCard);
            });

            productList.appendChild(fragment);
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('price-min').value = '';
            document.getElementById('price-max').value = '';
            document.querySelectorAll('input[name="brand"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="color"]').forEach(cb => cb.checked = false);

            // ì „ì²´ ìƒí’ˆ ë‹¤ì‹œ ë¡œë“œ
            const currentCategory = document.querySelector('.category-btn.active')?.dataset.category || 'ALL';
            filterByCategory(currentCategory);
            showToast('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // Toast ì•Œë¦¼ í•¨ìˆ˜
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateWishlistCount() {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const count = document.getElementById('wishlist-count');
            if (count) count.textContent = wishlist.length;
        }

        // ìµœê·¼ ë³¸ ìƒí’ˆ ë¡œë“œ
        function loadRecentProducts() {
            const recent = JSON.parse(localStorage.getItem('recentProducts')) || [];
            if (recent.length === 0) return;

            const section = document.getElementById('recent-products-section');
            const list = document.getElementById('recent-products-list');
            section.style.display = 'block';
            list.innerHTML = '';

            recent.slice(0, 5).forEach(productId => {
                const product = PRODUCTS.find(p => p.id === productId);
                if (!product) return;

                const card = document.createElement('div');
                card.className = 'product-card-small';
                card.onclick = function () { viewProduct(product.id); };
                card.innerHTML = `
                    <img data-src="${product.image}" alt="${product.name}" class="lazy-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='200'%3E%3Crect fill='%23f0f0f0' width='150' height='200'/%3E%3C/svg%3E">
                    <h4>${product.name}</h4>
                    <p>â‚©${product.price.toLocaleString()}</p>
                `;
                list.appendChild(card);
            });

            // ì§€ì—° ë¡œë”© ì ìš©
            if (window.lazyLoader) {
                window.lazyLoader.refresh();
            }
        }

        // ë‹¤í¬ëª¨ë“œ í† ê¸€
        document.getElementById('theme-toggle')?.addEventListener('click', function () {
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            this.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            showToast(isDark ? 'ë‹¤í¬ëª¨ë“œ í™œì„±í™”' : 'ë¼ì´íŠ¸ëª¨ë“œ í™œì„±í™”');
        });

        function loadTheme() {
            const theme = localStorage.getItem('theme');
            const toggle = document.getElementById('theme-toggle');
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                if (toggle) toggle.textContent = 'â˜€ï¸';
            }
        }

        // ìƒí’ˆ ì •ë ¬
        function sortProducts(sortType) {
            let products = [...PRODUCTS];

            if (sortType === 'price-low') {
                products.sort((a, b) => a.price - b.price);
            } else if (sortType === 'price-high') {
                products.sort((a, b) => b.price - a.price);
            } else if (sortType === 'popular') {
                products.sort((a, b) => {
                    const reviewsA = JSON.parse(localStorage.getItem(`reviews_${a.id}`)) || [];
                    const reviewsB = JSON.parse(localStorage.getItem(`reviews_${b.id}`)) || [];
                    return reviewsB.length - reviewsA.length;
                });
            } else if (sortType === 'rating') {
                products.sort((a, b) => {
                    const reviewsA = JSON.parse(localStorage.getItem(`reviews_${a.id}`)) || [];
                    const reviewsB = JSON.parse(localStorage.getItem(`reviews_${b.id}`)) || [];
                    const avgA = reviewsA.length > 0 ? reviewsA.reduce((sum, r) => sum + r.rating, 0) / reviewsA.length : 0;
                    const avgB = reviewsB.length > 0 ? reviewsB.reduce((sum, r) => sum + r.rating, 0) / reviewsB.length : 0;
                    return avgB - avgA;
                });
            }

            renderSortedProducts(products);
        }

        function renderSortedProducts(products) {
            const productList = document.getElementById("product-list");
            const categoryTitle = document.getElementById("category-title");

            productList.innerHTML = "";
            categoryTitle.textContent = "ì •ë ¬ëœ ìƒí’ˆ";

            const reviewsCache = {};
            products.forEach(product => {
                const reviews = JSON.parse(localStorage.getItem(`reviews_${product.id}`)) || [];
                reviewsCache[product.id] = {
                    count: reviews.length,
                    average: reviews.length > 0
                        ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1)
                        : 0
                };
            });

            const fragment = document.createDocumentFragment();

            products.forEach(product => {
                const reviewData = reviewsCache[product.id];
                const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
                const isWished = wishlist.includes(product.id);
                const totalStock = window.getTotalStock ? window.getTotalStock(product.id) : 999;
                const isSoldOut = totalStock === 0;

                const productCard = document.createElement("div");
                productCard.className = "product-card";
                if (isSoldOut) productCard.classList.add('sold-out');
                productCard.onclick = function () { viewProduct(product.id); };
                productCard.innerHTML = `
                    ${isSoldOut ? '<div class="sold-out-badge">í’ˆì ˆ</div>' : ''}
                    <button class="wishlist-btn ${isWished ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist(${product.id});" title="ì°œí•˜ê¸°">â¤ï¸</button>
                    <img src="${product.image}" alt="${product.name}" loading="lazy" ${isSoldOut ? 'style="opacity: 0.5;"' : ''}>
                    <h3>${product.name}</h3>
                    <p class="product-brand">${product.brand || ''}</p>
                    <p class="product-price">â‚©${product.price.toLocaleString()}</p>
                    <div class="product-colors">${(product.colors || []).map(c =>
                    `<span class="color-dot" style="background-color: ${getColorCode(c)};" title="${c}"></span>`
                ).join('')}</div>
                    <div class="product-review-info">
                        <span class="rating-stars">${'â­'.repeat(Math.round(reviewData.average))}</span>
                        <span class="rating-text">${reviewData.average} (${reviewData.count})</span>
                    </div>
                `;
                fragment.appendChild(productCard);
            });

            productList.appendChild(fragment);
        }

        // Debounce í•¨ìˆ˜ - ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ê²€ìƒ‰ í•¨ìˆ˜ë¥¼ debounceë¡œ ê°ì‹¸ê¸°
        const debouncedSearch = debounce(function (searchTerm) {
            searchProducts(searchTerm);
        }, 300);

        // Search functionality
        document.getElementById('search-btn').addEventListener('click', function () {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            searchProducts(searchTerm);
        });

        document.getElementById('search-input').addEventListener('keyup', function (e) {
            const searchTerm = this.value.toLowerCase();
            if (e.key === 'Enter') {
                searchProducts(searchTerm);
            } else {
                // íƒ€ì´í•‘ ì¤‘ì—ëŠ” debounce ì ìš©
                debouncedSearch(searchTerm);
            }
        });

        function searchProducts(searchTerm) {
            if (!searchTerm) {
                renderProducts();
                return;
            }

            const productList = document.getElementById("product-list");
            const categoryTitle = document.getElementById("category-title");

            productList.innerHTML = "";

            // ë„ì–´ì“°ê¸° ì œê±°í•œ ë²„ì „ìœ¼ë¡œë„ ê²€ìƒ‰
            const searchTermNoSpace = searchTerm.replace(/\s/g, '');

            const filteredProducts = PRODUCTS.filter(product => {
                const nameNoSpace = product.name.replace(/\s/g, '').toLowerCase();
                const categoryNoSpace = product.category.replace(/\s/g, '').toLowerCase();

                return product.name.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm) ||
                    nameNoSpace.includes(searchTermNoSpace) ||
                    categoryNoSpace.includes(searchTermNoSpace);
            });

            categoryTitle.textContent = `ê²€ìƒ‰ ê²°ê³¼: "${searchTerm}"`;

            if (filteredProducts.length === 0) {
                productList.innerHTML = "<p style='text-align: center; padding: 2rem;'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }

            // ë¦¬ë·° ë°ì´í„°ë¥¼ í•œ ë²ˆì— ìºì‹±
            const reviewsCache = {};
            filteredProducts.forEach(product => {
                const reviews = JSON.parse(localStorage.getItem(`reviews_${product.id}`)) || [];
                reviewsCache[product.id] = {
                    count: reviews.length,
                    average: reviews.length > 0
                        ? (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1)
                        : 0
                };
            });

            // DocumentFragment ì‚¬ìš©ìœ¼ë¡œ DOM ì¡°ì‘ ìµœì í™”
            const fragment = document.createDocumentFragment();
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];

            filteredProducts.forEach(product => {
                const reviewData = reviewsCache[product.id];
                const isWished = wishlist.includes(product.id);
                const totalStock = window.getTotalStock ? window.getTotalStock(product.id) : 999;
                const isSoldOut = totalStock === 0;

                const productCard = document.createElement("div");
                productCard.className = "product-card";
                if (isSoldOut) productCard.classList.add('sold-out');
                productCard.onclick = function () { viewProduct(product.id); };
                productCard.innerHTML = `
                    ${isSoldOut ? '<div class="sold-out-badge">í’ˆì ˆ</div>' : ''}
                    <button class="wishlist-btn ${isWished ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist(${product.id});" title="ì°œí•˜ê¸°">â¤ï¸</button>
                    <img src="${product.image}" alt="${product.name}" loading="lazy" ${isSoldOut ? 'style="opacity: 0.5;"' : ''}>
                    <h3>${product.name}</h3>
                    <p class="product-brand">${product.brand}</p>
                    <p class="product-price">â‚©${product.price.toLocaleString()}</p>
                    <div class="product-colors">${(product.colors || []).map(c =>
                    `<span class="color-dot" style="background-color: ${getColorCode(c)};" title="${c}"></span>`
                ).join('')}</div>
                    <div class="product-review-info">
                        <span class="rating-stars">${'â­'.repeat(Math.round(reviewData.average))}</span>
                        <span class="rating-text">${reviewData.average} (${reviewData.count})</span>
                    </div>
                `;
                fragment.appendChild(productCard);
            });

            productList.appendChild(fragment);
        }

        // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ (ë¡œê·¸ì¸ ì²´í¬ í¬í•¨)
        function addToCartFromIndex(productId) {
            if (!window.isLoggedIn || !window.isLoggedIn()) {
                if (confirm('ì¥ë°”êµ¬ë‹ˆëŠ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    window.location.href = 'login.html?return=' + encodeURIComponent(window.location.pathname);
                }
                return;
            }
            addToCart(productId);
            updateCartCount();
        }

        // ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateUserStatus() {
            const currentUser = getCurrentUser();
            const userInfo = document.getElementById('user-info');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');

            if (currentUser) {
                userInfo.textContent = currentUser.name + 'ë‹˜';
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
            } else {
                userInfo.textContent = 'ê²ŒìŠ¤íŠ¸';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸
        window.addEventListener('load', updateUserStatus);
    </script>
    <script src="performance.js"></script>
    <script>
        // ì„±ëŠ¥ ìµœì í™” ì ìš©
        document.addEventListener('DOMContentLoaded', () => {
            // ê²€ìƒ‰ ì…ë ¥ ë””ë°”ìš´ìŠ¤
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                const debouncedSearch = debounce((e) => {
                    const query = e.target.value.toLowerCase().trim();
                    if (query.length > 0) {
                        searchProducts(query);
                    } else {
                        loadProducts();
                    }
                }, 300);

                searchInput.addEventListener('input', debouncedSearch);
            }

            // ë¬´í•œ ìŠ¤í¬ë¡¤ ì´ˆê¸°í™” (ì„ íƒì )
            // infiniteScroll = new InfiniteScroll({
            //     container: document.getElementById('products-list'),
            //     loadMore: async (page) => {
            //         // ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ ë¡œì§
            //         return true; // ë” ë¡œë“œí•  ë°ì´í„°ê°€ ìˆìœ¼ë©´ true
            //     }
            // });
        });
    </script>
</body>

</html>
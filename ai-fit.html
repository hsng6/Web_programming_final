<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ– - AI í• ë¶„ì„</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <div class="search-container">
            <input type="text" id="search-input" placeholder="ìƒí’ˆ ê²€ìƒ‰...">
            <button id="search-btn">ê²€ìƒ‰</button>
        </div>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="ai-fit.html" class="ai-fit-link">ğŸ¤– AI í• ë¶„ì„</a>
            <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            <a href="orders.html">ì£¼ë¬¸ë‚´ì—­</a>
            <a href="support.html">ê³ ê°ì„¼í„°</a>
            <a href="wishlist.html" class="wishlist-link">â¤ï¸ ì°œ</a>
            <a href="cart.html" class="cart-link">ğŸ›ï¸ ì¥ë°”êµ¬ë‹ˆ</a>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        </nav>
    </header>

    <main class="ai-fit-container">
        <div class="ai-fit-header">
            <h2>ğŸ¤– AI ìŠ¤ë§ˆíŠ¸ í• ë¶„ì„</h2>
            <p class="ai-fit-description">
                ë‹¹ì‹ ì˜ ì‹ ì²´ ì¡°ê±´ì„ ì…ë ¥í•˜ë©´, AIê°€ ì™„ë²½í•œ í•ì„ ë¶„ì„í•˜ì—¬<br>
                ìµœì ì˜ ì‚¬ì´ì¦ˆì™€ ì–´ìš¸ë¦¬ëŠ” ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
            </p>
        </div>

        <!-- ì²´í˜• ì…ë ¥ ì„¹ì…˜ -->
        <section class="body-input-section" id="body-input-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>ğŸ“ ì‹ ì²´ ì •ë³´ ì…ë ¥</h3>
                <button type="button" class="btn-load-saved" onclick="loadSavedBodyInfo()"
                    style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    ğŸ“‚ ì €ì¥ëœ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
            </div>
            <form id="body-measurement-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="gender">ì„±ë³„ *</label>
                        <select id="gender" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="male">ë‚¨ì„±</option>
                            <option value="female">ì—¬ì„±</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="height">í‚¤ (cm) *</label>
                        <input type="number" id="height" placeholder="ì˜ˆ: 175" min="140" max="210" required>
                    </div>

                    <div class="form-group">
                        <label for="weight">ì²´ì¤‘ (kg) *</label>
                        <input type="number" id="weight" placeholder="ì˜ˆ: 70" min="40" max="150" required>
                    </div>

                    <div class="form-group">
                        <label for="chest">ê°€ìŠ´ë‘˜ë ˆ (cm)</label>
                        <input type="number" id="chest" placeholder="ì˜ˆ: 95" min="70" max="150">
                    </div>

                    <div class="form-group">
                        <label for="waist">í—ˆë¦¬ë‘˜ë ˆ (cm) *</label>
                        <input type="number" id="waist" placeholder="ì˜ˆ: 30" min="20" max="50" required>
                    </div>

                    <div class="form-group">
                        <label for="hip">ì—‰ë©ì´ë‘˜ë ˆ (cm)</label>
                        <input type="number" id="hip" placeholder="ì˜ˆ: 95" min="70" max="150">
                    </div>

                    <div class="form-group">
                        <label for="shoulder">ì–´ê¹¨ë„ˆë¹„ (cm)</label>
                        <input type="number" id="shoulder" placeholder="ì˜ˆ: 44" min="30" max="60">
                    </div>

                    <div class="form-group">
                        <label for="arm-length">íŒ”ê¸¸ì´ (cm)</label>
                        <input type="number" id="arm-length" placeholder="ì˜ˆ: 60" min="40" max="80">
                    </div>

                    <div class="form-group">
                        <label for="leg-length">ë‹¤ë¦¬ê¸¸ì´ (cm)</label>
                        <input type="number" id="leg-length" placeholder="ì˜ˆ: 105" min="70" max="130">
                    </div>

                    <div class="form-group">
                        <label for="body-type">ì²´í˜• íƒ€ì…</label>
                        <select id="body-type">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="slim">ë§ˆë¥¸ ì²´í˜•</option>
                            <option value="athletic">ìš´ë™ ì²´í˜•</option>
                            <option value="average">í‘œì¤€ ì²´í˜•</option>
                            <option value="muscular">ê·¼ìœ¡ì§ˆ ì²´í˜•</option>
                            <option value="curvy">í’ë§Œí•œ ì²´í˜•</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width" style="grid-column: 1 / -1;">
                    <label>ì„ í˜¸í•˜ëŠ” í• (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="fit-preference" value="tight"> íƒ€ì´íŠ¸ í•
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="fit-preference" value="slim"> ìŠ¬ë¦¼ í•
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="fit-preference" value="regular"> ë ˆê·¤ëŸ¬ í•
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="fit-preference" value="relaxed"> ë¦´ë ‰ìŠ¤ í•
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="fit-preference" value="oversized"> ì˜¤ë²„ì‚¬ì´ì¦ˆ í•
                        </label>
                    </div>
                </div>

                <div class="form-group full-width" style="grid-column: 1 / -1;">
                    <label>í• ê³ ë¯¼ì‚¬í•­ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="shoulder"> ì–´ê¹¨ê°€ ë„“ìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="shoulder-narrow"> ì–´ê¹¨ê°€ ì¢ìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="chest"> ê°€ìŠ´ì´ í¼
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="belly"> ë°°ê°€ ë‚˜ì˜´
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="hip"> ì—‰ë©ì´ê°€ í¼
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="arm"> íŒ”ì´ êµµìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="arm-short"> íŒ”ì´ ì§§ìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="leg"> ë‹¤ë¦¬ê°€ ì§§ìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="leg-thick"> ë‹¤ë¦¬ê°€ êµµìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="leg-thin"> ë‹¤ë¦¬ê°€ ì–‡ìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="neck-short"> ëª©ì´ ì§§ìŒ
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="torso-long"> ìƒì²´ê°€ ê¹€
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="concern" value="torso-short"> ìƒì²´ê°€ ì§§ìŒ
                        </label>
                    </div>
                </div>

                <button type="submit" class="ai-analyze-btn" style="grid-column: 1 / -1;">
                    ğŸ¤– AI í• ë¶„ì„ ì‹œì‘
                </button>
            </form>
        </section>

        <!-- AI ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ -->
        <section class="ai-result-section" id="ai-result-section" style="display: none;">
            <h3>ğŸ“Š AI ë¶„ì„ ê²°ê³¼</h3>

            <!-- BMI & ì²´í˜• ë¶„ì„ -->
            <div class="analysis-card">
                <h4>ğŸ“ˆ ì²´í˜• ë¶„ì„</h4>
                <div class="bmi-result">
                    <div class="bmi-info">
                        <p><strong>BMI ì§€ìˆ˜:</strong> <span id="bmi-value">0</span></p>
                        <p><strong>ì²´í˜• íŒì •:</strong> <span id="body-status">í‘œì¤€</span></p>
                    </div>
                    <div class="bmi-gauge">
                        <div class="bmi-bar">
                            <div class="bmi-indicator" id="bmi-indicator"></div>
                        </div>
                        <div class="bmi-labels">
                            <span>ì €ì²´ì¤‘</span>
                            <span>í‘œì¤€</span>
                            <span>ê³¼ì²´ì¤‘</span>
                            <span>ë¹„ë§Œ</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¶”ì²œ ì‚¬ì´ì¦ˆ -->
            <div class="analysis-card">
                <h4>ğŸ‘• ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ ì‚¬ì´ì¦ˆ</h4>
                <div class="size-recommendations" id="size-recommendations">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ìƒì„¸ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ -->
            <div class="analysis-card">
                <h4>ğŸ“ ìƒì„¸ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ</h4>
                <div class="size-guide-table" id="size-guide-table">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- í• ì¡°ì–¸ -->
            <div class="analysis-card">
                <h4>ğŸ’¡ AI ìŠ¤íƒ€ì¼ë§ ì¡°ì–¸</h4>
                <div class="fit-advice" id="fit-advice">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ì¶”ì²œ ìƒí’ˆ -->
            <div class="analysis-card">
                <h4>ğŸ¯ ë‹¹ì‹ ì„ ìœ„í•œ ë§ì¶¤ ì¶”ì²œ ìƒí’ˆ</h4>
                <div class="recommended-products" id="recommended-products">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn-save-profile" onclick="saveBodyProfile()">
                    ğŸ’¾ í”„ë¡œí•„ ì €ì¥í•˜ê¸°
                </button>
                <button class="btn-re-analyze" onclick="reAnalyze()">
                    ğŸ”„ ë‹¤ì‹œ ë¶„ì„í•˜ê¸°
                </button>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>

    <div id="toast" class="toast"></div>

    <script src="main.js"></script>
    <script>
        // AI í• ë¶„ì„ ì‹œìŠ¤í…œ
        const AI_FIT_SYSTEM = {
            // BMI ê³„ì‚°
            calculateBMI(height, weight) {
                const heightM = height / 100;
                return (weight / (heightM * heightM)).toFixed(1);
            },

            // BMI íŒì •
            getBMIStatus(bmi) {
                if (bmi < 18.5) return { status: 'ì €ì²´ì¤‘', color: '#5bc0de' };
                if (bmi < 23) return { status: 'í‘œì¤€', color: '#5cb85c' };
                if (bmi < 25) return { status: 'ê³¼ì²´ì¤‘', color: '#f0ad4e' };
                return { status: 'ë¹„ë§Œ', color: '#d9534f' };
            },

            // ì²´í˜• ë¹„ìœ¨ ë¶„ì„
            analyzeBodyRatio(data) {
                const { height, weight, chest, waist, hip, shoulder } = data;
                const analysis = {
                    shoulderToWaist: shoulder && waist ? (shoulder / waist).toFixed(2) : null,
                    waistToHip: waist && hip ? (waist / hip).toFixed(2) : null,
                    upperBody: chest && waist ? chest - waist : null,
                    lowerBody: hip && waist ? hip - waist : null
                };
                return analysis;
            },

            // ì‚¬ì´ì¦ˆ ì¶”ì²œ (ìƒì˜)
            recommendTopSize(data) {
                const { gender, height, weight, chest, shoulder } = data;
                let size = 'M';
                let detailedSize = {};

                if (gender === 'male') {
                    if (chest < 90) size = 'S';
                    else if (chest < 96) size = 'M';
                    else if (chest < 102) size = 'L';
                    else if (chest < 108) size = 'XL';
                    else size = 'XXL';

                    detailedSize = {
                        chest: chest || Math.round(weight * 1.3 + 5),
                        shoulder: shoulder || Math.round(height * 0.25),
                        length: Math.round(height * 0.42),
                        sleeve: Math.round(height * 0.34)
                    };
                } else {
                    if (chest < 82) size = 'S';
                    else if (chest < 88) size = 'M';
                    else if (chest < 94) size = 'L';
                    else if (chest < 100) size = 'XL';
                    else size = 'XXL';

                    detailedSize = {
                        chest: chest || Math.round(weight * 1.2 + 5),
                        shoulder: shoulder || Math.round(height * 0.23),
                        length: Math.round(height * 0.38),
                        sleeve: Math.round(height * 0.32)
                    };
                }

                return { size, detailedSize };
            },

            // ì‚¬ì´ì¦ˆ ì¶”ì²œ (í•˜ì˜)
            recommendBottomSize(data) {
                const { gender, height, waist, hip, legLength } = data;
                let size = 30;
                let detailedSize = {};

                // í—ˆë¦¬ ì‚¬ì´ì¦ˆ ê¸°ë°˜
                size = waist || Math.round(height * 0.17);

                if (gender === 'male') {
                    detailedSize = {
                        waist: waist || size,
                        hip: hip || Math.round(size * 1.3),
                        rise: Math.round(height * 0.16),
                        inseam: legLength || Math.round(height * 0.45),
                        thigh: Math.round(size * 0.8),
                        hem: Math.round(size * 0.5)
                    };
                } else {
                    detailedSize = {
                        waist: waist || size,
                        hip: hip || Math.round(size * 1.4),
                        rise: Math.round(height * 0.14),
                        inseam: legLength || Math.round(height * 0.43),
                        thigh: Math.round(size * 0.85),
                        hem: Math.round(size * 0.45)
                    };
                }

                return { size, detailedSize };
            },

            // ì•„ìš°í„° ì‚¬ì´ì¦ˆ ì¶”ì²œ
            recommendOuterSize(data) {
                const topSize = this.recommendTopSize(data);
                const { fitPreference } = data;

                let adjustedSize = topSize.size;
                if (fitPreference === 'oversized') {
                    const sizeMap = { 'S': 'M', 'M': 'L', 'L': 'XL', 'XL': 'XXL', 'XXL': 'XXXL' };
                    adjustedSize = sizeMap[topSize.size] || 'XXL';
                } else if (fitPreference === 'tight') {
                    const sizeMap = { 'M': 'S', 'L': 'M', 'XL': 'L', 'XXL': 'XL' };
                    adjustedSize = sizeMap[topSize.size] || topSize.size;
                }

                return { size: adjustedSize, detailedSize: topSize.detailedSize };
            },

            // ì‹ ë°œ ì‚¬ì´ì¦ˆ ì¶”ì²œ
            recommendShoeSize(data) {
                const { gender, height } = data;
                let size;

                if (gender === 'male') {
                    size = Math.round(height * 0.15);
                } else {
                    size = Math.round(height * 0.14);
                }

                return { size, note: 'ë°œ í˜•íƒœì— ë”°ë¼ Â±0.5cm ì¡°ì • ê¶Œì¥' };
            },

            // ìŠ¤íƒ€ì¼ë§ ì¡°ì–¸ ìƒì„±
            generateStylingAdvice(data) {
                const { bodyType, concern, fitPreference, gender } = data;
                const advice = [];

                // ì²´í˜•ë³„ ì¡°ì–¸
                if (bodyType === 'slim') {
                    advice.push('ë§ˆë¥¸ ì²´í˜•ì€ ë ˆì´ì–´ë“œ ë£©ìœ¼ë¡œ ë³¼ë¥¨ê°ì„ ë”í•˜ì„¸ìš”.');
                    advice.push('ì˜¤ë²„ì‚¬ì´ì¦ˆë‚˜ ë¦´ë ‰ìŠ¤ í•ì´ ìŠ¤íƒ€ì¼ë¦¬ì‹œí•´ ë³´ì…ë‹ˆë‹¤.');
                } else if (bodyType === 'athletic') {
                    advice.push('íƒ„íƒ„í•œ ì²´í˜•ì€ ìŠ¬ë¦¼í•ì´ ë©‹ìŠ¤ëŸ¬ì›Œ ë³´ì…ë‹ˆë‹¤.');
                    advice.push('ìŠ¤íŠ¸ë ˆì¹˜ ì†Œì¬ë¡œ í™œë™ì„±ì„ ë†’ì´ì„¸ìš”.');
                } else if (bodyType === 'muscular') {
                    advice.push('ê·¼ìœ¡ì§ˆ ì²´í˜•ì€ ë ˆê·¤ëŸ¬ í•ì´ í¸ì•ˆí•˜ê³  ê· í˜•ì¡í˜€ ë³´ì…ë‹ˆë‹¤.');
                    advice.push('ì–´ê¹¨ì„ ì´ ë§ëŠ” ì˜·ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.');
                } else if (bodyType === 'curvy') {
                    advice.push('ê³¡ì„ ë¯¸ë¥¼ ì‚´ë¦¬ëŠ” ì„¸ë¯¸í• ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•©ë‹ˆë‹¤.');
                    advice.push('ì‹ ì¶•ì„± ìˆëŠ” ì†Œì¬ê°€ í¸ì•ˆí•©ë‹ˆë‹¤.');
                }

                // ê³ ë¯¼ì‚¬í•­ë³„ ì¡°ì–¸
                if (concern === 'belly') {
                    advice.push('âœ“ í—ˆë¦¬ë¼ì¸ì´ ë£¨ì¦ˆí•œ ìŠ¤íƒ€ì¼ë¡œ ì»¤ë²„í•˜ì„¸ìš”.');
                    advice.push('âœ“ ê¸´ ê¸°ì¥ì˜ ìƒì˜ë‚˜ ì•„ìš°í„°ë¡œ ì‹œì„ ì„ ë¶„ì‚°ì‹œí‚¤ì„¸ìš”.');
                } else if (concern === 'shoulder') {
                    advice.push('âœ“ ë˜ê¸€ëŸ° ìŠ¬ë¦¬ë¸Œë‚˜ ë“œë¡­ ìˆ„ë”ë¡œ ì–´ê¹¨ë¥¼ ë¶€ë“œëŸ½ê²Œ í‘œí˜„í•˜ì„¸ìš”.');
                    advice.push('âœ“ Vë„¥ ìƒì˜ë¡œ ìƒì²´ ì‹¤ë£¨ì—£ì„ ìŠ¬ë¦¼í•˜ê²Œ ë§Œë“œì„¸ìš”.');
                } else if (concern === 'leg-thick') {
                    advice.push('âœ“ ìŠ¤íŠ¸ë ˆì´íŠ¸ë‚˜ ì™€ì´ë“œ í• ë°”ì§€ë¡œ í•˜ì²´ ê· í˜•ì„ ë§ì¶”ì„¸ìš”.');
                    advice.push('âœ“ ì–´ë‘ìš´ ìƒ‰ìƒì˜ í•˜ì˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                } else if (concern === 'leg') {
                    advice.push('âœ“ í—ˆë¦¬ë¼ì¸ì´ ë†’ì€ í•˜ì˜ë¡œ ë‹¤ë¦¬ë¥¼ ê¸¸ì–´ë³´ì´ê²Œ í•˜ì„¸ìš”.');
                    advice.push('âœ“ í¬ë¡­ ìƒì˜ì™€ í•˜ì´ì›¨ì´ìŠ¤íŠ¸ ì¡°í•©ì„ ì¶”ì²œí•©ë‹ˆë‹¤.');
                }

                // ì„ í˜¸ í•ë³„ ì¡°ì–¸
                if (fitPreference === 'oversized') {
                    advice.push('ì˜¤ë²„ì‚¬ì´ì¦ˆëŠ” í•˜ì˜ë¥¼ ìŠ¬ë¦¼í•˜ê²Œ ë§¤ì¹˜í•˜ë©´ ê· í˜•ê°ì´ ì¢‹ìŠµë‹ˆë‹¤.');
                } else if (fitPreference === 'slim') {
                    advice.push('ìŠ¬ë¦¼í•ì€ ì‹ ì¶•ì„± ìˆëŠ” ì†Œì¬ë¥¼ ì„ íƒí•˜ë©´ í™œë™ì´ í¸í•©ë‹ˆë‹¤.');
                }

                return advice;
            },

            // ë§ì¶¤ ìƒí’ˆ ì¶”ì²œ
            recommendProducts(data, allProducts) {
                const { bodyType, fitPreference, concern, gender } = data;
                const topSize = this.recommendTopSize(data);
                const bottomSize = this.recommendBottomSize(data);

                const recommended = [];

                allProducts.forEach(product => {
                    let score = 0;
                    const productName = product.name.toLowerCase();

                    // ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¹­
                    if (product.category === 'TOPS') {
                        if (bodyType === 'slim' && (productName.includes('ì˜¤ë²„') || productName.includes('ë£¨ì¦ˆ'))) score += 3;
                        if (bodyType === 'athletic' && productName.includes('ìŠ¬ë¦¼')) score += 3;
                        if (concern === 'belly' && (productName.includes('ë¡±') || productName.includes('ë£¨ì¦ˆ'))) score += 2;
                    } else if (product.category === 'PANTS') {
                        if (concern === 'leg-thick' && (productName.includes('ì™€ì´ë“œ') || productName.includes('ìŠ¤íŠ¸ë ˆì´íŠ¸'))) score += 3;
                        if (concern === 'leg' && productName.includes('í•˜ì´ì›¨ì´ìŠ¤íŠ¸')) score += 3;
                    } else if (product.category === 'OUTER') {
                        if (fitPreference === 'oversized' && productName.includes('ì˜¤ë²„')) score += 3;
                    }

                    // ê°€ê²©ëŒ€ ê³ ë ¤ (ë‹¤ì–‘ì„±)
                    if (product.price < 50000) score += 1;

                    if (score > 0) {
                        recommended.push({ ...product, fitScore: score });
                    }
                });

                // ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³  ìƒìœ„ 6ê°œ ë°˜í™˜
                return recommended.sort((a, b) => b.fitScore - a.fitScore).slice(0, 6);
            }
        };

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('body-measurement-form').addEventListener('submit', function (e) {
            e.preventDefault();

            // ì²´í¬ë°•ìŠ¤ì—ì„œ ì„ íƒëœ ê°’ë“¤ ìˆ˜ì§‘
            const fitPreferences = Array.from(document.querySelectorAll('input[name="fit-preference"]:checked'))
                .map(cb => cb.value);
            const concerns = Array.from(document.querySelectorAll('input[name="concern"]:checked'))
                .map(cb => cb.value);

            const data = {
                gender: document.getElementById('gender').value,
                height: parseInt(document.getElementById('height').value),
                weight: parseInt(document.getElementById('weight').value),
                chest: parseInt(document.getElementById('chest').value) || null,
                waist: parseInt(document.getElementById('waist').value),
                hip: parseInt(document.getElementById('hip').value) || null,
                shoulder: parseInt(document.getElementById('shoulder').value) || null,
                armLength: parseInt(document.getElementById('arm-length').value) || null,
                legLength: parseInt(document.getElementById('leg-length').value) || null,
                bodyType: document.getElementById('body-type').value,
                fitPreference: fitPreferences, // ë°°ì—´ë¡œ ì €ì¥
                concern: concerns // ë°°ì—´ë¡œ ì €ì¥
            };

            // AI ë¶„ì„ ì‹œì‘
            analyzeBody(data);

            // ì‹ ì²´ ì •ë³´ ì €ì¥ (ë‚˜ì¤‘ì— ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´)
            localStorage.setItem('savedBodyInfo', JSON.stringify(data));
        });

        // ì €ì¥ëœ ì‹ ì²´ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedBodyInfo() {
            const savedInfo = localStorage.getItem('savedBodyInfo');

            if (!savedInfo) {
                showToast('ì €ì¥ëœ ì‹ ì²´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const data = JSON.parse(savedInfo);

            // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('gender').value = data.gender || '';
            document.getElementById('height').value = data.height || '';
            document.getElementById('weight').value = data.weight || '';
            document.getElementById('chest').value = data.chest || '';
            document.getElementById('waist').value = data.waist || '';
            document.getElementById('hip').value = data.hip || '';
            document.getElementById('shoulder').value = data.shoulder || '';
            document.getElementById('arm-length').value = data.armLength || '';
            document.getElementById('leg-length').value = data.legLength || '';
            document.getElementById('body-type').value = data.bodyType || '';

            // ì²´í¬ë°•ìŠ¤ ì²´í¬ í•´ì œ í›„ ì €ì¥ëœ ê°’ ì²´í¬
            document.querySelectorAll('input[name="fit-preference"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="concern"]').forEach(cb => cb.checked = false);

            // ì„ í˜¸í•˜ëŠ” í• ë³µì› (ë°°ì—´ ë˜ëŠ” ë¬¸ìì—´ ì²˜ë¦¬)
            const fitPreferences = Array.isArray(data.fitPreference) ? data.fitPreference : (data.fitPreference ? [data.fitPreference] : []);
            fitPreferences.forEach(value => {
                const checkbox = document.querySelector(`input[name="fit-preference"][value="${value}"]`);
                if (checkbox) checkbox.checked = true;
            });

            // í• ê³ ë¯¼ì‚¬í•­ ë³µì› (ë°°ì—´ ë˜ëŠ” ë¬¸ìì—´ ì²˜ë¦¬)
            const concerns = Array.isArray(data.concern) ? data.concern : (data.concern ? [data.concern] : []);
            concerns.forEach(value => {
                const checkbox = document.querySelector(`input[name="concern"][value="${value}"]`);
                if (checkbox) checkbox.checked = true;
            });

            showToast('ì €ì¥ëœ ì‹ ì²´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ“‚');
        }

        function analyzeBody(data) {
            // ë¡œë”© í‘œì‹œ
            showToast('AIê°€ ë‹¹ì‹ ì˜ ì²´í˜•ì„ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤... ğŸ¤–');

            setTimeout(() => {
                // BMI ê³„ì‚°
                const bmi = AI_FIT_SYSTEM.calculateBMI(data.height, data.weight);
                const bmiStatus = AI_FIT_SYSTEM.getBMIStatus(bmi);

                document.getElementById('bmi-value').textContent = bmi;
                document.getElementById('body-status').textContent = bmiStatus.status;
                document.getElementById('body-status').style.color = bmiStatus.color;

                // BMI ê²Œì´ì§€ ì„¤ì •
                const bmiIndicator = document.getElementById('bmi-indicator');
                const bmiPosition = ((bmi - 15) / 20) * 100;
                bmiIndicator.style.left = Math.min(Math.max(bmiPosition, 0), 100) + '%';
                bmiIndicator.style.backgroundColor = bmiStatus.color;

                // ì¹´í…Œê³ ë¦¬ë³„ ì‚¬ì´ì¦ˆ ì¶”ì²œ
                const topSize = AI_FIT_SYSTEM.recommendTopSize(data);
                const bottomSize = AI_FIT_SYSTEM.recommendBottomSize(data);
                const outerSize = AI_FIT_SYSTEM.recommendOuterSize(data);
                const shoeSize = AI_FIT_SYSTEM.recommendShoeSize(data);

                const sizeRecommendations = document.getElementById('size-recommendations');
                sizeRecommendations.innerHTML = `
                    <div class="size-card">
                        <div class="size-icon">ğŸ‘•</div>
                        <h5>ìƒì˜ (TOPS)</h5>
                        <p class="size-value">${topSize.size}</p>
                        <p class="size-detail">ê°€ìŠ´ë‘˜ë ˆ ${topSize.detailedSize.chest}cm ê¶Œì¥</p>
                    </div>
                    <div class="size-card">
                        <div class="size-icon">ğŸ‘–</div>
                        <h5>í•˜ì˜ (PANTS)</h5>
                        <p class="size-value">${bottomSize.size}ì¸ì¹˜</p>
                        <p class="size-detail">í—ˆë¦¬ë‘˜ë ˆ ${bottomSize.detailedSize.waist}ì¸ì¹˜ ê¶Œì¥</p>
                    </div>
                    <div class="size-card">
                        <div class="size-icon">ğŸ§¥</div>
                        <h5>ì•„ìš°í„° (OUTER)</h5>
                        <p class="size-value">${outerSize.size}</p>
                        <p class="size-detail">ì—¬ìœ ìˆëŠ” í• ê¶Œì¥</p>
                    </div>
                    <div class="size-card">
                        <div class="size-icon">ğŸ‘Ÿ</div>
                        <h5>ì‹ ë°œ (SHOES)</h5>
                        <p class="size-value">${shoeSize.size}mm</p>
                        <p class="size-detail">${shoeSize.note}</p>
                    </div>
                `;

                // ìƒì„¸ ì‚¬ì´ì¦ˆ ê°€ì´ë“œ
                const sizeGuideTable = document.getElementById('size-guide-table');
                sizeGuideTable.innerHTML = `
                    <div class="size-table">
                        <h5>ìƒì˜ ì„¸ë¶€ ì¸¡ì •ì¹˜</h5>
                        <table>
                            <tr><td>ê°€ìŠ´ë‘˜ë ˆ</td><td>${topSize.detailedSize.chest}cm</td></tr>
                            <tr><td>ì–´ê¹¨ë„ˆë¹„</td><td>${topSize.detailedSize.shoulder}cm</td></tr>
                            <tr><td>ì´ì¥</td><td>${topSize.detailedSize.length}cm</td></tr>
                            <tr><td>ì†Œë§¤ê¸¸ì´</td><td>${topSize.detailedSize.sleeve}cm</td></tr>
                        </table>
                    </div>
                    <div class="size-table">
                        <h5>í•˜ì˜ ì„¸ë¶€ ì¸¡ì •ì¹˜</h5>
                        <table>
                            <tr><td>í—ˆë¦¬ë‘˜ë ˆ</td><td>${bottomSize.detailedSize.waist}ì¸ì¹˜</td></tr>
                            <tr><td>ì—‰ë©ì´ë‘˜ë ˆ</td><td>${bottomSize.detailedSize.hip}cm</td></tr>
                            <tr><td>ë°‘ìœ„</td><td>${bottomSize.detailedSize.rise}cm</td></tr>
                            <tr><td>ì•ˆìª½ê¸¸ì´</td><td>${bottomSize.detailedSize.inseam}cm</td></tr>
                            <tr><td>í—ˆë²…ì§€ë‘˜ë ˆ</td><td>${bottomSize.detailedSize.thigh}cm</td></tr>
                            <tr><td>ë°‘ë‹¨</td><td>${bottomSize.detailedSize.hem}cm</td></tr>
                        </table>
                    </div>
                `;

                // ìŠ¤íƒ€ì¼ë§ ì¡°ì–¸
                const advice = AI_FIT_SYSTEM.generateStylingAdvice(data);
                const fitAdvice = document.getElementById('fit-advice');
                fitAdvice.innerHTML = advice.map(tip => `<p class="advice-item">ğŸ’¡ ${tip}</p>`).join('');

                // ë§ì¶¤ ìƒí’ˆ ì¶”ì²œ
                const recommendedProducts = AI_FIT_SYSTEM.recommendProducts(data, PRODUCTS);
                const productsContainer = document.getElementById('recommended-products');
                productsContainer.innerHTML = recommendedProducts.map(product => `
                    <div class="product-card-ai" onclick="viewProduct(${product.id})">
                        <div class="fit-badge">í• ë§¤ì¹˜ ${product.fitScore * 33}%</div>
                        <img src="${product.image}" alt="${product.name}" loading="lazy">
                        <h4>${product.name}</h4>
                        <p class="product-price">â‚©${product.price.toLocaleString()}</p>
                        <p class="fit-reason">ì¶”ì²œ ì‚¬ì´ì¦ˆ: ${topSize.size}</p>
                    </div>
                `).join('');

                // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
                document.getElementById('body-input-section').style.display = 'none';
                document.getElementById('ai-result-section').style.display = 'block';

                // ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                window.scrollTo({ top: 0, behavior: 'smooth' });

                showToast('AI ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨');

                // ë¶„ì„ ë°ì´í„° ì €ì¥
                localStorage.setItem('bodyAnalysis', JSON.stringify({
                    data,
                    topSize,
                    bottomSize,
                    outerSize,
                    shoeSize,
                    timestamp: new Date().toISOString()
                }));
            }, 2000);
        }

        function saveBodyProfile() {
            const analysis = localStorage.getItem('bodyAnalysis');
            if (analysis) {
                showToast('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìŒë¶€í„° ìë™ìœ¼ë¡œ ë§ì¶¤ ì‚¬ì´ì¦ˆê°€ í‘œì‹œë©ë‹ˆë‹¤. ğŸ’¾');
            }
        }

        function reAnalyze() {
            document.getElementById('ai-result-section').style.display = 'none';
            document.getElementById('body-input-section').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // í…Œë§ˆ ë¡œë“œ
        function loadTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // ì¹´íŠ¸ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const totalItems = cart.reduce((sum, item) => sum + (parseInt(item.qty) || 0), 0);
            const countElement = document.getElementById('cart-count');
            if (countElement) {
                if (totalItems > 0) {
                    countElement.classList.add('has-items');
                } else {
                    countElement.classList.remove('has-items');
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function () {
            loadTheme();
            updateCartCount();

            // ì €ì¥ëœ ì‹ ì²´ ì •ë³´ í™•ì¸
            const savedInfo = localStorage.getItem('savedBodyInfo');
            if (savedInfo) {
                showToast('ğŸ’¡ ì´ì „ì— ì…ë ¥í•œ ì‹ ì²´ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤. "ì €ì¥ëœ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!', 5000);
            }

            // ì €ì¥ëœ ë¶„ì„ì´ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸° ì˜µì…˜ í‘œì‹œ
            const savedAnalysis = localStorage.getItem('bodyAnalysis');
            if (savedAnalysis) {
                const analysis = JSON.parse(savedAnalysis);
                const timeDiff = new Date() - new Date(analysis.timestamp);
                const daysDiff = timeDiff / (1000 * 60 * 60 * 24);

                if (daysDiff < 30) {
                    const loadSaved = confirm('ì´ì „ì— ì €ì¥ëœ ì²´í˜• ë¶„ì„ì´ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (loadSaved) {
                        analyzeBody(analysis.data);
                    }
                }
            }
        });
    </script>
</body>

</html>
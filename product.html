<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ– - ìƒí’ˆ ìƒì„¸</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="ai-fit.html" class="ai-fit-link">ğŸ¤– AI í•</a>
            <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            <a href="orders.html">ì£¼ë¬¸ë‚´ì—­</a>
            <a href="support.html">ê³ ê°ì„¼í„°</a>
            <a href="wishlist.html" class="wishlist-link">â¤ï¸ ì°œ</a>
            <a href="cart.html">ì¥ë°”êµ¬ë‹ˆ</a>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        </nav>
    </header>
    <main>
        <section id="product-detail">
          <div class="product-gallery">
            <img src="" alt="Product Image" id="main-image">
          </div>
  
          <div class="product-info">
            <h2 id="product-name">ìƒí’ˆ ì´ë¦„</h2>
            <p id="product-price">â‚©0</p>
            <p id="product-category" style="color: #666; margin: 0.5rem 0;">ì¹´í…Œê³ ë¦¬</p>
            <p id="product-description">ìƒí’ˆ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
  
            <!-- ì‚¬ì´ì¦ˆ ì„ íƒ -->
            <div class="size-selection">
              <label for="product-size"><strong>ì‚¬ì´ì¦ˆ ì„ íƒ:</strong></label>
              <select id="product-size" required>
                <option value="">ì‚¬ì´ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
              </select>
              <a href="ai-fit.html" class="ai-fit-recommendation">
                ğŸ¤– ë‚´ ì‚¬ì´ì¦ˆ ì°¾ê¸° (AI ì¶”ì²œ)
              </a>
            </div>

            <!-- ìˆ˜ëŸ‰ ì„ íƒ -->
            <div class="quantity-selection">
              <label for="product-quantity"><strong>ìˆ˜ëŸ‰:</strong></label>
              <div class="quantity-controls">
                <button type="button" class="qty-btn" onclick="decreaseQuantity()">-</button>
                <input type="number" id="product-quantity" value="1" min="1" max="99" readonly>
                <button type="button" class="qty-btn" onclick="increaseQuantity()">+</button>
              </div>
            </div>

            <!-- ì´ ê°€ê²© -->
            <div class="total-price-display">
              <span>ì´ ê¸ˆì•¡:</span>
              <span id="total-price" class="total-price-value">â‚©0</span>
            </div>
  
            <button id="add-to-cart-btn">ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€</button>
          </div>
        </section>

        <!-- Reviews Section -->
        <section id="reviews-section">
            <h2>ìƒí’ˆ ë¦¬ë·°</h2>
            <div id="reviews-list">
                <!-- Reviews will be loaded here -->
            </div>

            <div id="review-form-container">
                <h3>ë¦¬ë·° ì‘ì„±í•˜ê¸°</h3>
                <form id="review-form">
                    <label for="reviewer-name">ì´ë¦„:</label>
                    <input type="text" id="reviewer-name" required>

                    <label for="review-rating">í‰ì :</label>
                    <select id="review-rating" required>
                        <option value="5">â­â­â­â­â­ (5ì )</option>
                        <option value="4">â­â­â­â­ (4ì )</option>
                        <option value="3">â­â­â­ (3ì )</option>
                        <option value="2">â­â­ (2ì )</option>
                        <option value="1">â­ (1ì )</option>
                    </select>

                    <label for="review-text">ë¦¬ë·° ë‚´ìš©:</label>
                    <textarea id="review-text" rows="4" required></textarea>

                    <button type="submit">ë¦¬ë·° ë“±ë¡</button>
                </form>
            </div>
        </section>
      </main>
    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>
    <script src="main.js"></script>
    <script>
        // Get product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = parseInt(urlParams.get('id'));
        let currentProduct = null;

        // ì‚¬ì´ì¦ˆ ì˜µì…˜ ì„¤ì •
        const SIZE_OPTIONS = {
            'TOPS': ['S', 'M', 'L', 'XL', 'XXL'],
            'PANTS': ['28', '29', '30', '31', '32', '33', '34', '36'],
            'OUTER': ['S', 'M', 'L', 'XL', 'XXL'],
            'SHOES': ['240', '245', '250', '255', '260', '265', '270', '275', '280', '285', '290']
        };

        // ìˆ˜ëŸ‰ ì¦ê°€/ê°ì†Œ
        function increaseQuantity() {
            const qtyInput = document.getElementById('product-quantity');
            const currentQty = parseInt(qtyInput.value);
            if (currentQty < 99) {
                qtyInput.value = currentQty + 1;
                updateTotalPrice();
            }
        }

        function decreaseQuantity() {
            const qtyInput = document.getElementById('product-quantity');
            const currentQty = parseInt(qtyInput.value);
            if (currentQty > 1) {
                qtyInput.value = currentQty - 1;
                updateTotalPrice();
            }
        }

        // ì´ ê°€ê²© ì—…ë°ì´íŠ¸
        function updateTotalPrice() {
            if (currentProduct) {
                const quantity = parseInt(document.getElementById('product-quantity').value);
                const totalPrice = currentProduct.price * quantity;
                document.getElementById('total-price').textContent = `â‚©${totalPrice.toLocaleString()}`;
            }
        }

        // Load product details
        function loadProductDetails() {
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) {
                alert("ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                window.location.href = "index.html";
                return;
            }

            currentProduct = product;

            document.getElementById('main-image').src = product.image;
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-price').textContent = `â‚©${product.price.toLocaleString()}`;
            document.getElementById('product-category').textContent = `ì¹´í…Œê³ ë¦¬: ${product.category}`;
            document.getElementById('product-description').textContent = `${product.name}ì˜ ìƒì„¸ ì„¤ëª…ì…ë‹ˆë‹¤.`;

            // ì‚¬ì´ì¦ˆ ì˜µì…˜ ì¶”ê°€
            const sizeSelect = document.getElementById('product-size');
            const sizes = SIZE_OPTIONS[product.category] || ['FREE'];
            
            sizeSelect.innerHTML = '<option value="">ì‚¬ì´ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            sizes.forEach(size => {
                const option = document.createElement('option');
                option.value = size;
                option.textContent = size;
                sizeSelect.appendChild(option);
            });

            // ì‚¬ì´ì¦ˆ ë³€ê²½ ì‹œ AI ì¶”ì²œ í‘œì‹œ
            const savedAnalysis = localStorage.getItem('bodyAnalysis');
            if (savedAnalysis) {
                const analysis = JSON.parse(savedAnalysis);
                let recommendedSize = '';

                if (product.category === 'TOPS') {
                    recommendedSize = analysis.topSize?.size || '';
                } else if (product.category === 'PANTS') {
                    recommendedSize = analysis.bottomSize?.size + '' || '';
                } else if (product.category === 'OUTER') {
                    recommendedSize = analysis.outerSize?.size || '';
                } else if (product.category === 'SHOES') {
                    recommendedSize = analysis.shoeSize?.size + '' || '';
                }

                if (recommendedSize && sizes.includes(recommendedSize)) {
                    // ì¶”ì²œ ì‚¬ì´ì¦ˆ í•˜ì´ë¼ì´íŠ¸
                    const fitRecommendation = document.querySelector('.ai-fit-recommendation');
                    fitRecommendation.innerHTML = `ğŸ¤– AI ì¶”ì²œ ì‚¬ì´ì¦ˆ: <strong>${recommendedSize}</strong>`;
                    fitRecommendation.style.color = '#667eea';
                }
            }

            // ì´ˆê¸° ì´ ê°€ê²© ì„¤ì •
            updateTotalPrice();

            // Add to cart button
            document.getElementById('add-to-cart-btn').addEventListener('click', function() {
                const size = document.getElementById('product-size').value;
                const quantity = parseInt(document.getElementById('product-quantity').value);

                if (!size) {
                    alert('ì‚¬ì´ì¦ˆë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                    return;
                }

                if (quantity < 1) {
                    alert('ìˆ˜ëŸ‰ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!');
                    return;
                }

                addToCartWithOptions(currentProduct, size, quantity);
            });
        }

        // ì˜µì…˜ í¬í•¨ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
        function addToCartWithOptions(product, size, quantity) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            
            // ê°™ì€ ìƒí’ˆ, ê°™ì€ ì‚¬ì´ì¦ˆê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
            const existingItemIndex = cart.findIndex(item => 
                item.id === product.id && item.size === size
            );

            if (existingItemIndex > -1) {
                // ì´ë¯¸ ìˆìœ¼ë©´ ìˆ˜ëŸ‰ë§Œ ì¦ê°€
                cart[existingItemIndex].quantity += quantity;
            } else {
                // ìƒˆë¡œìš´ í•­ëª© ì¶”ê°€
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    category: product.category,
                    size: size,
                    quantity: quantity
                });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            
            showToast(`${product.name} (ì‚¬ì´ì¦ˆ: ${size}, ìˆ˜ëŸ‰: ${quantity}ê°œ)ê°€ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ›’`);
            updateCartCount();
            
            // ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í• ì§€ ë¬»ê¸°
            setTimeout(() => {
                if (confirm('ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    window.location.href = 'cart.html';
                }
            }, 500);
        }

        // Load reviews for this product
        function loadReviews() {
            const reviews = JSON.parse(localStorage.getItem(`reviews_${productId}`)) || [];
            const reviewsList = document.getElementById('reviews-list');
            
            reviewsList.innerHTML = "";
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = "<p>ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>";
                return;
            }

            reviews.forEach((review, index) => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'review-item';
                const stars = 'â­'.repeat(review.rating);
                reviewDiv.innerHTML = `
                    <div class="review-header">
                        <h4>${review.name} <span class="review-rating">${stars}</span></h4>
                        <div class="review-actions">
                            <button class="edit-review-btn" onclick="editReview(${index})">ìˆ˜ì •</button>
                            <button class="delete-review-btn" onclick="deleteReview(${index})">ì‚­ì œ</button>
                        </div>
                    </div>
                    <p class="review-date">${review.date}</p>
                    <p class="review-text">${review.text}</p>
                `;
                reviewsList.appendChild(reviewDiv);
            });
        }

        // Delete review
        function deleteReview(index) {
            if (!confirm('ì •ë§ë¡œ ì´ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const reviews = JSON.parse(localStorage.getItem(`reviews_${productId}`)) || [];
            reviews.splice(index, 1);
            localStorage.setItem(`reviews_${productId}`, JSON.stringify(reviews));
            loadReviews();
            alert('ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // Edit review
        function editReview(index) {
            const reviews = JSON.parse(localStorage.getItem(`reviews_${productId}`)) || [];
            const review = reviews[index];
            
            // Fill form with existing review data
            document.getElementById('reviewer-name').value = review.name;
            document.getElementById('review-rating').value = review.rating;
            document.getElementById('review-text').value = review.text;
            
            // Change form to edit mode
            const submitBtn = document.querySelector('#review-form button[type="submit"]');
            submitBtn.textContent = 'ë¦¬ë·° ìˆ˜ì •';
            submitBtn.dataset.editIndex = index;
            
            // Scroll to form
            document.getElementById('review-form-container').scrollIntoView({ behavior: 'smooth' });
        }

        // Handle review form submission
        document.getElementById('review-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('reviewer-name').value;
            const rating = parseInt(document.getElementById('review-rating').value);
            const text = document.getElementById('review-text').value;
            const submitBtn = this.querySelector('button[type="submit"]');
            const editIndex = submitBtn.dataset.editIndex;
            
            const reviews = JSON.parse(localStorage.getItem(`reviews_${productId}`)) || [];
            
            if (editIndex !== undefined) {
                // Update existing review
                reviews[editIndex] = {
                    name: name,
                    rating: rating,
                    text: text,
                    date: reviews[editIndex].date // Keep original date
                };
                alert('ë¦¬ë·°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // Reset form to add mode
                submitBtn.textContent = 'ë¦¬ë·° ë“±ë¡';
                delete submitBtn.dataset.editIndex;
            } else {
                // Add new review
                reviews.push({
                    name: name,
                    rating: rating,
                    text: text,
                    date: new Date().toLocaleDateString('ko-KR')
                });
                alert('ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
            
            localStorage.setItem(`reviews_${productId}`, JSON.stringify(reviews));
            
            // Clear form
            document.getElementById('review-form').reset();
            
            // Reload reviews
            loadReviews();
        });

        // Load theme on page load
        function loadTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadProductDetails();
            loadReviews();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìˆ– - ì¶”ì²œ ìƒí’ˆ</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <a href="index.html" class="logo">
            <h1>ì¸ìˆ–</h1>
        </a>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="ai-fit.html" class="ai-fit-link">ğŸ¤– AI í•</a>
            <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            <a href="orders.html">ì£¼ë¬¸ë‚´ì—­</a>
            <a href="support.html">ê³ ê°ì„¼í„°</a>
            <a href="wishlist.html" class="wishlist-link">â¤ï¸ ì°œ</a>
            <a href="cart.html" class="cart-link">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        </nav>
    </header>

    <main class="recommendations-container">
        <h2>âœ¨ ë§ì¶¤ ì¶”ì²œ</h2>
        <p class="subtitle">ê³ ê°ë‹˜ì˜ ì·¨í–¥ì„ ë¶„ì„í•œ ê°œì¸í™” ì¶”ì²œ ìƒí’ˆ</p>

        <!-- ìµœê·¼ ë³¸ ìƒí’ˆ ê¸°ë°˜ ì¶”ì²œ -->
        <section class="recommendation-section">
            <h3>ğŸ” ìµœê·¼ ë³¸ ìƒí’ˆê³¼ ë¹„ìŠ·í•œ ì¶”ì²œ</h3>
            <div id="similar-products" class="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- êµ¬ë§¤ íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ì¶”ì²œ -->
        <section class="recommendation-section">
            <h3>ğŸ›ï¸ êµ¬ë§¤ íŒ¨í„´ ë¶„ì„ ì¶”ì²œ</h3>
            <div id="purchase-based" class="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- ì°œí•œ ìƒí’ˆ ê¸°ë°˜ ì¶”ì²œ -->
        <section class="recommendation-section">
            <h3>â¤ï¸ ì°œí•œ ìƒí’ˆê³¼ ì–´ìš¸ë¦¬ëŠ” ì¶”ì²œ</h3>
            <div id="wishlist-based" class="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- ì¸ê¸° ìƒí’ˆ ì¶”ì²œ -->
        <section class="recommendation-section">
            <h3>ğŸ”¥ ì§€ê¸ˆ ì¸ê¸°ìˆëŠ” ìƒí’ˆ</h3>
            <div id="trending-products" class="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- ìµœê·¼ ì¶”ê°€ëœ ì‹ ìƒí’ˆ -->
        <section class="recommendation-section">
            <h3>ğŸ†• NEW ì‹ ìƒí’ˆ</h3>
            <div id="new-arrivals" class="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 ì¸ìˆ–. All rights reserved.</p>
    </footer>

    <script src="main.js"></script>
    <script>
        // ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜
        function getRecommendations() {
            const viewHistory = JSON.parse(localStorage.getItem('viewHistory')) || [];
            const purchaseHistory = JSON.parse(localStorage.getItem('purchaseHistory')) || [];
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];

            return {
                similar: getSimilarProducts(viewHistory),
                purchaseBased: getPurchaseBasedRecommendations(purchaseHistory),
                wishlistBased: getWishlistBasedRecommendations(wishlist),
                trending: getTrendingProducts(),
                newArrivals: getNewArrivals()
            };
        }

        function getSimilarProducts(viewHistory) {
            if (viewHistory.length === 0) return getRandomProducts(4);

            // ìµœê·¼ ë³¸ ìƒí’ˆë“¤ì˜ ì¹´í…Œê³ ë¦¬ì™€ ë¸Œëœë“œ ë¶„ì„
            const recentViews = viewHistory.slice(-5);
            const categories = recentViews.map(id => PRODUCTS.find(p => p.id === id)?.category).filter(Boolean);
            const brands = recentViews.map(id => PRODUCTS.find(p => p.id === id)?.brand).filter(Boolean);

            // ê°™ì€ ì¹´í…Œê³ ë¦¬ ë˜ëŠ” ë¸Œëœë“œì˜ ë‹¤ë¥¸ ìƒí’ˆ
            return PRODUCTS
                .filter(p => !viewHistory.includes(p.id))
                .filter(p => categories.includes(p.category) || brands.includes(p.brand))
                .slice(0, 4);
        }

        function getPurchaseBasedRecommendations(purchaseHistory) {
            if (purchaseHistory.length === 0) return getRandomProducts(4);

            // êµ¬ë§¤í•œ ìƒí’ˆë“¤ì˜ ê°€ê²©ëŒ€ì™€ ì¹´í…Œê³ ë¦¬ ë¶„ì„
            const purchasedProducts = purchaseHistory.map(orderId => {
                const order = JSON.parse(localStorage.getItem(`order_${orderId}`));
                return order ? order.items : [];
            }).flat();

            const avgPrice = purchasedProducts.reduce((sum, item) => sum + item.price, 0) / purchasedProducts.length;
            const purchasedCategories = purchasedProducts.map(item => item.category).filter(Boolean);

            // ë¹„ìŠ·í•œ ê°€ê²©ëŒ€ì™€ ì¹´í…Œê³ ë¦¬
            return PRODUCTS
                .filter(p => Math.abs(p.price - avgPrice) < avgPrice * 0.3)
                .filter(p => purchasedCategories.includes(p.category))
                .slice(0, 4);
        }

        function getWishlistBasedRecommendations(wishlist) {
            if (wishlist.length === 0) return getRandomProducts(4);

            // ì°œí•œ ìƒí’ˆë“¤ì˜ ë¸Œëœë“œì™€ ì»¬ëŸ¬ ë¶„ì„
            const wishlistProducts = wishlist.map(id => PRODUCTS.find(p => p.id === id)).filter(Boolean);
            const colors = wishlistProducts.map(p => p.colors).flat();
            const brands = wishlistProducts.map(p => p.brand);

            // ë¹„ìŠ·í•œ ìƒ‰ìƒì´ë‚˜ ë¸Œëœë“œ
            return PRODUCTS
                .filter(p => !wishlist.includes(p.id))
                .filter(p => {
                    const hasCommonColor = p.colors.some(c => colors.includes(c));
                    const hasSameBrand = brands.includes(p.brand);
                    return hasCommonColor || hasSameBrand;
                })
                .slice(0, 4);
        }

        function getTrendingProducts() {
            // ê°€ì¥ ë§ì´ ë³¸ ìƒí’ˆ (ì‹¤ì œë¡œëŠ” ì¡°íšŒìˆ˜ ë°ì´í„° ì‚¬ìš©)
            const allViews = JSON.parse(localStorage.getItem('viewHistory')) || [];
            const viewCounts = {};

            allViews.forEach(id => {
                viewCounts[id] = (viewCounts[id] || 0) + 1;
            });

            const sortedByViews = Object.entries(viewCounts)
                .sort((a, b) => b[1] - a[1])
                .map(([id]) => parseInt(id))
                .slice(0, 4);

            const trending = sortedByViews.map(id => PRODUCTS.find(p => p.id === id)).filter(Boolean);

            // ì¡°íšŒ ë°ì´í„°ê°€ ë¶€ì¡±í•˜ë©´ ëœë¤ ì¶”ê°€
            while (trending.length < 4) {
                const randomProduct = PRODUCTS[Math.floor(Math.random() * PRODUCTS.length)];
                if (!trending.some(p => p.id === randomProduct.id)) {
                    trending.push(randomProduct);
                }
            }

            return trending;
        }

        function getNewArrivals() {
            // IDê°€ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœê·¼ ì¶”ê°€ëœ ìƒí’ˆ)
            return [...PRODUCTS]
                .sort((a, b) => b.id - a.id)
                .slice(0, 4);
        }

        function getRandomProducts(count) {
            const shuffled = [...PRODUCTS].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        function renderProducts(containerId, products) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (products.length === 0) {
                container.innerHTML = '<p class="empty-message">ì¶”ì²œí•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => {
                    addToViewHistory(product.id);
                    window.location.href = `product.html?id=${product.id}`;
                };

                productCard.innerHTML = `
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="product-info">
                        <p class="product-brand">${product.brand || ''}</p>
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-price">${product.price.toLocaleString()}ì›</p>
                        ${product.colors ? `
                            <div class="product-colors">
                                ${product.colors.slice(0, 3).map(color =>
                    `<span class="color-dot" style="background: ${getColorCode(color)}" title="${color}"></span>`
                ).join('')}
                                ${product.colors.length > 3 ? `<span class="color-more">+${product.colors.length - 3}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        function addToViewHistory(productId) {
            const viewHistory = JSON.parse(localStorage.getItem('viewHistory')) || [];
            viewHistory.push(productId);

            // ìµœê·¼ 50ê°œë§Œ ìœ ì§€
            if (viewHistory.length > 50) {
                viewHistory.shift();
            }

            localStorage.setItem('viewHistory', JSON.stringify(viewHistory));
        }

        function getColorCode(colorName) {
            const colorMap = {
                'í™”ì´íŠ¸': '#FFFFFF',
                'ë¸”ë™': '#000000',
                'ê·¸ë ˆì´': '#808080',
                'ë„¤ì´ë¹„': '#000080',
                'ë¸”ë£¨': '#0000FF',
                'ë¼ì´íŠ¸ë¸”ë£¨': '#ADD8E6',
                'ë² ì´ì§€': '#F5F5DC',
                'ë¸Œë¼ìš´': '#8B4513',
                'ì¹´í‚¤': '#C3B091',
                'ì¹´ë©œ': '#C19A6B',
                'í•‘í¬': '#FFC0CB',
                'ì•„ì´ë³´ë¦¬': '#FFFFF0'
            };
            return colorMap[colorName] || '#CCCCCC';
        }

        function loadTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        document.addEventListener('DOMContentLoaded', function () {
            loadTheme();

            const recommendations = getRecommendations();
            renderProducts('similar-products', recommendations.similar);
            renderProducts('purchase-based', recommendations.purchaseBased);
            renderProducts('wishlist-based', recommendations.wishlistBased);
            renderProducts('trending-products', recommendations.trending);
            renderProducts('new-arrivals', recommendations.newArrivals);
        });
    </script>
</body>

</html>